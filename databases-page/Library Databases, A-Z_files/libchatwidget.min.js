/**
 * @license
 * lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash include="template"`
 * Copyright jQuery Foundation and other contributors <https://jquery.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
/*!
 * Generated using the Bootstrap Customizer (http://getbootstrap.com/customize/?id=dadaa52e391e0928c5814a632d1fe79a)
 * Config saved to config.json and https://gist.github.com/dadaa52e391e0928c5814a632d1fe79a
 */
if(function(){var t=/\b__p \+= '';/g,e=/\b(__p \+=) '' \+/g,i=/(__e\(.*?\)|\b__t\)) \+\n'';/g,s=/[&<>"']/g,n=RegExp(s.source),o=/<%=([\s\S]+?)%>/g,r=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,a=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,h=/($^)/,c=/['\n\r\u2028\u2029\\]/g,d=-1,u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u["[object Arguments]"]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u["[object Map]"]=u["[object Number]"]=u["[object Object]"]=u["[object RegExp]"]=u["[object Set]"]=u["[object String]"]=u["[object WeakMap]"]=!1;var p={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},g="object"==typeof global&&global&&global.Object===Object&&global,m="object"==typeof self&&self&&self.Object===Object&&self,f=g||m||Function("return this")(),b="object"==typeof exports&&exports&&!exports.nodeType&&exports,v=b&&"object"==typeof module&&module&&!module.nodeType&&module,y=v&&v.exports===b,w=y&&g.process,S=function(){try{return w&&w.binding("util")}catch(t){}}(),_=S&&S.isTypedArray;function C(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function $(t,e){for(var i=-1,s=t?t.length:0,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}var E,k=(E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(t){return null==E?void 0:E[t]});function T(t){return"\\"+p[t]}var x,O,I,F=Function.prototype,M=Object.prototype,L=f["__core-js_shared__"],A=(x=/[^.]+$/.exec(L&&L.keys&&L.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"",D=F.toString,j=M.hasOwnProperty,q=M.toString,N=RegExp("^"+D.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=y?f.Buffer:void 0,R=f.Symbol,z=M.propertyIsEnumerable,U=function(){try{var t=function(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){if(!ft(t)||function(t){return!!A&&A in t}(t))return!1;return(gt(t)?N:a).test(function(t){if(null!=t){try{return D.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}(i)?i:void 0}(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),B=P?P.isBuffer:void 0,V=(O=Object.keys,I=Object,function(t){return O(I(t))}),W=Math.max,H=Date.now,Q=R?R.prototype:void 0,J=Q?Q.toString:void 0;function Y(){}function G(t,e){var i=ct(t),s=!i&&ht(t),n=!i&&!s&&ut(t),o=!i&&!s&&!n&&yt(t),r=i||s||n||o,a=r?function(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}(t.length,String):[],l=a.length;for(var h in t)!e&&!j.call(t,h)||r&&("length"==h||n&&("offset"==h||"parent"==h)||o&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||nt(h,l))||a.push(h);return a}function X(t,e,i,s){return void 0===t||lt(t,M[i])&&!j.call(s,i)?e:t}function Z(t,e,i){var s=t[e];j.call(t,e)&&lt(s,i)&&(void 0!==i||e in t)||K(t,e,i)}function K(t,e,i){"__proto__"==e&&U?U(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function tt(t){return bt(t)&&"[object Arguments]"==q.call(t)}function et(t){if(!ft(t))return function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}(t);var e=rt(t),i=[];for(var s in t)("constructor"!=s||!e&&j.call(t,s))&&i.push(s);return i}function it(t,e){return at(function(t,e,i){return e=W(void 0===e?t.length-1:e,0),function(){for(var s=arguments,n=-1,o=W(s.length-e,0),r=Array(o);++n<o;)r[n]=s[e+n];n=-1;for(var a=Array(e+1);++n<e;)a[n]=s[n];return a[e]=i(r),C(t,this,a)}}(t,e,Tt),t+"")}function st(t){if("string"==typeof t)return t;if(ct(t))return $(t,st)+"";if(vt(t))return J?J.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function nt(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||l.test(t))&&t>-1&&t%1==0&&t<e}function ot(t,e,i){if(!ft(i))return!1;var s=typeof e;return!!("number"==s?dt(i)&&nt(e,i.length):"string"==s&&e in i)&&lt(i[e],t)}function rt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||M)}Y.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:o,variable:"",imports:{_:Y}};var at=function(t){var e=0,i=0;return function(){var s=H(),n=16-(s-i);if(i=s,n>0){if(++e>=500)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(U?function(t,e){return U(t,"toString",{configurable:!0,enumerable:!1,value:kt(e),writable:!0})}:Tt);function lt(t,e){return t===e||t!=t&&e!=e}var ht=tt(function(){return arguments}())?tt:function(t){return bt(t)&&j.call(t,"callee")&&!z.call(t,"callee")},ct=Array.isArray;function dt(t){return null!=t&&mt(t.length)&&!gt(t)}var ut=B||xt;function pt(t){return!!bt(t)&&("[object Error]"==q.call(t)||"string"==typeof t.message&&"string"==typeof t.name)}function gt(t){var e=ft(t)?q.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object Proxy]"==e}function mt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function ft(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function bt(t){return null!=t&&"object"==typeof t}function vt(t){return"symbol"==typeof t||bt(t)&&"[object Symbol]"==q.call(t)}var yt=_?function(t){return function(e){return t(e)}}(_):function(t){return bt(t)&&mt(t.length)&&!!u[q.call(t)]};function wt(t){return null==t?"":st(t)}var St,_t=(St=function(t,e,i,s){!function(t,e,i,s){var n=!i;i||(i={});for(var o=-1,r=e.length;++o<r;){var a=e[o],l=s?s(i[a],t[a],a,i,t):void 0;void 0===l&&(l=t[a]),n?K(i,a,l):Z(i,a,l)}}(e,$t(e),t,s)},it((function(t,e){var i=-1,s=e.length,n=s>1?e[s-1]:void 0,o=s>2?e[2]:void 0;for(n=St.length>3&&"function"==typeof n?(s--,n):void 0,o&&ot(e[0],e[1],o)&&(n=s<3?void 0:n,s=1),t=Object(t);++i<s;){var r=e[i];r&&St(t,r,i,n)}return t})));function Ct(t){return dt(t)?G(t):function(t){if(!rt(t))return V(t);var e=[];for(var i in Object(t))j.call(t,i)&&"constructor"!=i&&e.push(i);return e}(t)}function $t(t){return dt(t)?G(t,!0):et(t)}var Et=it((function(t,e){try{return C(t,void 0,e)}catch(t){return pt(t)?t:new Error(t)}}));function kt(t){return function(){return t}}function Tt(t){return t}function xt(){return!1}Y.assignInWith=_t,Y.constant=kt,Y.keys=Ct,Y.keysIn=$t,Y.extendWith=_t,Y.attempt=Et,Y.eq=lt,Y.escape=function(t){return(t=wt(t))&&n.test(t)?t.replace(s,k):t},Y.identity=Tt,Y.isArguments=ht,Y.isArray=ct,Y.isArrayLike=dt,Y.isBuffer=ut,Y.isError=pt,Y.isFunction=gt,Y.isLength=mt,Y.isObject=ft,Y.isObjectLike=bt,Y.isSymbol=vt,Y.isTypedArray=yt,Y.stubFalse=xt,Y.template=function(s,n,a){var l=Y.templateSettings;a&&ot(s,n,a)&&(n=void 0),s=wt(s),n=_t({},n,l,X);var u,p,g=_t({},n.imports,l.imports,X),m=Ct(g),f=function(t,e){return $(e,(function(e){return t[e]}))}(g,m),b=0,v=n.interpolate||h,y="__p += '",w=RegExp((n.escape||h).source+"|"+v.source+"|"+(v===o?r:h).source+"|"+(n.evaluate||h).source+"|$","g"),S="//# sourceURL="+("sourceURL"in n?n.sourceURL:"lodash.templateSources["+ ++d+"]")+"\n";s.replace(w,(function(t,e,i,n,o,r){return i||(i=n),y+=s.slice(b,r).replace(c,T),e&&(u=!0,y+="' +\n__e("+e+") +\n'"),o&&(p=!0,y+="';\n"+o+";\n__p += '"),i&&(y+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),b=r+t.length,t})),y+="';\n";var _=n.variable;_||(y="with (obj) {\n"+y+"\n}\n"),y=(p?y.replace(t,""):y).replace(e,"$1").replace(i,"$1;"),y="function("+(_||"obj")+") {\n"+(_?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(u?", __e = _.escape":"")+(p?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+y+"return __p\n}";var C=Et((function(){return Function(m,S+"return "+y).apply(void 0,f)}));if(C.source=y,pt(C))throw C;return C},Y.toString=wt,Y.VERSION="4.16.4","function"==typeof define&&"object"==typeof define.amd&&define.amd?(f._=Y,define((function(){return Y}))):v?((v.exports=Y)._=Y,b._=Y):f._=Y}.call(this),"undefined"!=typeof _&&(_.templateSettings={evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#\{]([\s\S]+?)[^\}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g}),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(t){"use strict";var e=jQuery.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||e[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(),function(t){"use strict";var e=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};e.VERSION="3.3.7",e.TRANSITION_DURATION=150,e.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},e.prototype.init=function(e,i,s){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(s),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var n=this.options.trigger.split(" "),o=n.length;o--;){var r=n[o];if("click"==r)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=r){var a="hover"==r?"mouseenter":"focusin",l="hover"==r?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.getOptions=function(e){return(e=t.extend({},this.getDefaults(),this.$element.data(),e)).delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},e.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,(function(t,s){i[t]!=s&&(e[t]=s)})),e},e.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState)i.hoverState="in";else{if(clearTimeout(i.timeout),i.hoverState="in",!i.options.delay||!i.options.delay.show)return i.show();i.timeout=setTimeout((function(){"in"==i.hoverState&&i.show()}),i.options.delay.show)}},e.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},e.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),!i.isInStateTrue()){if(clearTimeout(i.timeout),i.hoverState="out",!i.options.delay||!i.options.delay.hide)return i.hide();i.timeout=setTimeout((function(){"out"==i.hoverState&&i.hide()}),i.options.delay.hide)}},e.prototype.show=function(){var i=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(i);var s=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(i.isDefaultPrevented()||!s)return;var n=this,o=this.tip(),r=this.getUID(this.type);this.setContent(),o.attr("id",r),this.$element.attr("aria-describedby",r),this.options.animation&&o.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,h=l.test(a);h&&(a=a.replace(l,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),d=o[0].offsetWidth,u=o[0].offsetHeight;if(h){var p=a,g=this.getPosition(this.$viewport);a="bottom"==a&&c.bottom+u>g.bottom?"top":"top"==a&&c.top-u<g.top?"bottom":"right"==a&&c.right+d>g.width?"left":"left"==a&&c.left-d<g.left?"right":a,o.removeClass(p).addClass(a)}var m=this.getCalculatedOffset(a,c,d,u);this.applyPlacement(m,a);var f=function(){var t=n.hoverState;n.$element.trigger("shown.bs."+n.type),n.hoverState=null,"out"==t&&n.leave(n)};t.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",f).emulateTransitionEnd(e.TRANSITION_DURATION):f()}},e.prototype.applyPlacement=function(e,i){var s=this.tip(),n=s[0].offsetWidth,o=s[0].offsetHeight,r=parseInt(s.css("margin-top"),10),a=parseInt(s.css("margin-left"),10);isNaN(r)&&(r=0),isNaN(a)&&(a=0),e.top+=r,e.left+=a,t.offset.setOffset(s[0],t.extend({using:function(t){s.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),s.addClass("in");var l=s[0].offsetWidth,h=s[0].offsetHeight;"top"==i&&h!=o&&(e.top=e.top+o-h);var c=this.getViewportAdjustedDelta(i,e,l,h);c.left?e.left+=c.left:e.top+=c.top;var d=/top|bottom/.test(i),u=d?2*c.left-n+l:2*c.top-o+h,p=d?"offsetWidth":"offsetHeight";s.offset(e),this.replaceArrow(u,s[0][p],d)},e.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},e.prototype.hide=function(i){var s=this,n=t(this.$tip),o=t.Event("hide.bs."+this.type);function r(){"in"!=s.hoverState&&n.detach(),s.$element&&s.$element.removeAttr("aria-describedby").trigger("hidden.bs."+s.type),i&&i()}if(this.$element.trigger(o),!o.isDefaultPrevented())return n.removeClass("in"),t.support.transition&&n.hasClass("fade")?n.one("bsTransitionEnd",r).emulateTransitionEnd(e.TRANSITION_DURATION):r(),this.hoverState=null,this},e.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},e.prototype.hasContent=function(){return this.getTitle()},e.prototype.getPosition=function(e){var i=(e=e||this.$element)[0],s="BODY"==i.tagName,n=i.getBoundingClientRect();null==n.width&&(n=t.extend({},n,{width:n.right-n.left,height:n.bottom-n.top}));var o=window.SVGElement&&i instanceof window.SVGElement,r=s?{top:0,left:0}:o?null:e.offset(),a={scroll:s?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},l=s?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},n,a,l,r)},e.prototype.getCalculatedOffset=function(t,e,i,s){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-s,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-s/2,left:e.left-i}:{top:e.top+e.height/2-s/2,left:e.left+e.width}},e.prototype.getViewportAdjustedDelta=function(t,e,i,s){var n={top:0,left:0};if(!this.$viewport)return n;var o=this.options.viewport&&this.options.viewport.padding||0,r=this.getPosition(this.$viewport);if(/right|left/.test(t)){var a=e.top-o-r.scroll,l=e.top+o-r.scroll+s;a<r.top?n.top=r.top-a:l>r.top+r.height&&(n.top=r.top+r.height-l)}else{var h=e.left-o,c=e.left+o+i;h<r.left?n.left=r.left-h:c>r.right&&(n.left=r.left+r.width-c)}return n},e.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},e.prototype.getUID=function(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},e.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},e.prototype.enable=function(){this.enabled=!0},e.prototype.disable=function(){this.enabled=!1},e.prototype.toggleEnabled=function(){this.enabled=!this.enabled},e.prototype.toggle=function(e){var i=this;e&&((i=t(e.currentTarget).data("bs."+this.type))||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},e.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide((function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null}))};var i=t.fn.tooltip;t.fn.tooltip=function(i){return this.each((function(){var s=t(this),n=s.data("bs.tooltip"),o="object"==typeof i&&i;!n&&/destroy|hide/.test(i)||(n||s.data("bs.tooltip",n=new e(this,o)),"string"==typeof i&&n[i]())}))},t.fn.tooltip.Constructor=e,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=i,this}}(jQuery),(springSpace=springSpace||{}).regex={email:/^<?(['a-zA-Z0-9_=\.\-\+&!#\$%\*\?\^\|\{\}\~])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,6})+>?$/i,url:/^((mailto|https?):)*\/\/.+/i,phone:/^\+?[0-9]{10,}$/,date:/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/,datetime:/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}(:[0-9]{2})?$/,color:/^#([a-f0-9A-F]{6}|[a-f0-9A-F]{3})$/},function(){var t=function(){this.events={},this.debug=!1,this.listenerIndex=function(t,e){return this.events[t].findIndex((function(t){return t.listener===e}),this)},this.on=function(t,e,i){if("function"==typeof e){if(void 0===i&&(i=null),this.events[t]=this.events[t]||[],this.events[t].length>0){var s=this.listenerIndex(t,e);s>-1&&this.events[t].splice(s,1)}this.events[t].push({listener:e,boundObj:i})}},this.off=function(t,e){if(Array.isArray(this.events[t])){var i=this.listenerIndex(t,e);if(-1===i)return;this.events[t].splice(i,1),0===this.events[t].length&&delete this.events[t]}},this.once=function(t,e,i){this.on(t,(function s(){this.off(t,s);var n=void 0===i?this:i;e.apply(n,arguments)}))},this.trigger=function(t){this.debug&&console&&console.log("sui.eventemitter triggered: "+t);var e=[].slice.call(arguments,1);Array.isArray(this.events[t])&&this.events[t].forEach((function(t){var i=null===t.boundObj?this:t.boundObj;t.listener.apply(i,e)}),this)}};"undefined"!=typeof module?module.exports=t:(this.springSpace=this.springSpace||{},this.springSpace.sui=this.springSpace.sui||{},this.springSpace.sui.eventEmitter=t)}(),(springSpace=springSpace||{}).sui=springSpace.sui||{},springSpace.sui.notify_=function(){this.parent_id="s-ui-alertarea",this.html_id="s-ui-notification",this.className="s-ui-notification",this.timeout=null,this.error=function(t){void 0!==t&&""!==t||(t="Error: Please try again.");var e={className:"s-ui-notification-error",duration:5e3,msg:t};this.show(e)},this.success=function(t){void 0!==t&&""!==t||(t="Success.");var e={className:"s-ui-notification-success",duration:5e3,msg:t};this.show(e)},this.working=function(t){void 0!==t&&""!==t||(t=' <i class="fa fa-spinner fa-3x fa-pulse"></i><span class="sr-only">Working...</span> '),settings={msg:t,duration:3e4},this.show(settings)},this.show=function(t){var e=this;if(void 0!==t&&t.msg&&""!==t.msg&&null!==t.msg){t.duration||0===t.duration||(t.duration=5e3);var i=jQuery("#"+this.html_id);if(i.length>0&&i.remove(),i=jQuery("<div></div>").attr({id:this.html_id}),0==(s=jQuery("#"+this.parent_id)).length)var s=jQuery("<div></div>").attr({id:this.parent_id,role:"alert"}).appendTo(jQuery("body"));i.appendTo(s);var n={};t.bgcolor&&(n.backgroundColor=t.bgcolor),t.fgcolor&&(n.color=t.fgcolor),i.addClass(t.className?t.className:this.className).html(t.msg).css(n).on("mouseover",(function(){clearTimeout(e.timeout)})).on("mouseout",(function(){t.duration>0&&(e.timeout=setTimeout(e.hide.bind(e),t.duration))})).on("click",e.hide.bind(e)).wrapInner('<div class="s-ui-notification-message" />');var o=jQuery(window).width(),r=jQuery(window).height(),a=i.outerWidth(),l=r/2-i.outerHeight()/2,h=o/2-a/2;i.css({top:l,left:h}).fadeIn(200,(function(){t.duration>0&&(e.timeout=setTimeout(e.hide.bind(e),t.duration))}))}},this.hide=function(){jQuery("#"+this.html_id).off("mouseover mouseout").fadeOut(200,(function(){jQuery(this).empty()})),clearTimeout(this.timeout)}},springSpace.sui.notify=new springSpace.sui.notify_,function(){var t={defaults:{},emitter:null,init:function(t,e){this.set(t,{silent:!0}),void 0!==e&&(this.emitter=e)},get:function(t){if(void 0!==this[t])return this[t];var e=void 0!==this.defaults[t]?this.defaults[t]:null;return"object"!=typeof e?e:null===e?null:JSON.parse(JSON.stringify(e))},set:function(t,e,i){var s=[];"object"==typeof t?(i=e,Object.keys(t).forEach((function(e){this.sameValues(this.get(e),t[e])||s.push(e),this[e]=t[e]}),this)):(this.sameValues(this.get(t),e)||s.push(t),this[t]=e);void 0===i&&(i={silent:!1}),i.silent||null===this.emitter||!i.silent&&s.length>0&&(s.forEach((function(t){this.emitter.trigger("change:"+t,{model:this})}),this),this.emitter.trigger("change",{model:this}))},sameValues:function(t,e){return JSON.stringify(t)===JSON.stringify(e)},reset:function(){Object.keys(this.defaults).forEach((function(t){delete this[t]}),this)},toJSON:function(){var t={};return Object.keys(this.defaults).forEach((function(e){t[e]=void 0!==this[e]?this[e]:this.defaults[e]}),this),t},trigger:function(){this.emitter.trigger.apply(this.emitter,arguments)}};"undefined"!=typeof module?module.exports=t:this.springyModel=t}();const removeCoverageFromRule=function(t){return{u:t.u,d:t.d,c:t.c,fallbackSeconds:t.fallbackSeconds||0}},isCoverageInRange=function(t,e,i){if(0===i.length)return!1;for(let s=0;s<=i.length;s++){const n=i[s];if(!Array.isArray(n)||2!==n.length)continue;const o=n[0].split(":").map(t=>parseInt(t,10)),r=n[1].split(":").map(t=>parseInt(t,10));if(!(o[0]>t||r[0]<t)){if(o[0]<t&&r[0]>t)return!0;if(o[0]!==t){if(r[0]!==t);else if(r[1]>e)return!0}else if(o[1]<e)return!0}}return!1};var springSpace,adjustStatusRequestForCoverage=function(t){const e=[],i=new Date,s=i.getUTCDay(),n=i.getUTCHours(),o=i.getUTCMinutes();return t.forEach(t=>{if(!t.c||1===t.coverageType)return void e.push(removeCoverageFromRule(t));if(0===t.coverageType)return;const i=t.coverageHours;if(!i||!i[s]||0===i[s].length)return;const r=i[s];isCoverageInRange(n,o,r)&&e.push(removeCoverageFromRule(t))}),e};!function(t){t.springSpace=t.springSpace||{},t.springSpace.chat=t.springSpace.chat||{},t.springSpace.chat.ChatMessage=function(t){this.sessionId=t.sessionId?t.sessionId:"",this.opId=t.opId?parseInt(t.opId,10):0,this.role=t.role?t.role:"system",this.room=t.room?t.room:"",this.ts=t.ts?t.ts:"",this.msg=t.msg?t.msg:"",""===this.ts&&(this.ts=(new Date).toISOString()),this.ended=!!t.ended}}(this),function(t){const e=t.springSpace.regex,i=t.springyModel,s=Object.create(i);s.defaults={name:"",id:0,show:0,required:0,type:"t",val:""};const n=Object.create(i);n.defaults={id:0,iid:0,hash:"",name:"",key:"",queue_id:0,auth_id:0,unit_id:0,chat_title:"Welcome to LibChat!",byeMsg:"Thanks for chatting!",dept_label:"Select Department:",name_label:"Name (blank=anonymous)",name_default:"",guest_label:"Guest",contact_label:"Contact Info",width:"100%",height:340,chat_button:"Start Chat",press_enter:"Press ENTER to send",submit_button:"Submit",email_trans:"View/Email Transcript",offline_text:"Ask Us",offline_url:"",slidebutton_url:"",slidebutton_url_off:"",slidebutton_text:"Ask Us",slidebutton_text_off:"Offline",slidebutton_position:"r",slidebutton_bcolor:"#286090",slidebutton_color:"#ffffff",slidebutton_bcolor_off:"#286090",slidebutton_color_off:"#ffffff",slidebutton_width:"",slidebutton_height:"",la_hide:!0,la_hide_msg:"Sorry, chat is offline but you can still get help.",la_hide_msg2:'<a href="{{ domain }}" target="_parent">Search our Knowledgebase and/or submit your question</a>',la_search_opt:{group_id:0,button:"Search",placeholder:"",label:""},la_search_box:"",star_text:"How did we do?",rate_1:"Bad",rate_2:"So-so",rate_3:"Good",rate_4:"Great",trans:"Enter an email address to send this chat transcript to:",error_sess:"Error starting session.",error_send:"Error sending this message.",initial_question:!1,initial_question_label:"Your Question",comments_label:"Any comments?",comments_button_text:"Submit Feedback",comments_followup:"I would like to be contacted for a follow-up.",comments_email:"Email yourself a transcript of this chat",enable_anon:!0,enable_sound:!1,star_ratings:!0,file_uploads:!0,file_title:"Upload File",file_intro:"Note: Maximum file size is 20MB. File is removed after one month, it is not kept permanently.",file_label:"Attach a file",file_action:"Upload",cancel_button:"Cancel",custom_css:"",color_backg:"#f9f9f9",color_head:"#286090",color_btn:"#FFFFFF",color_border:"",user1:null,user2:null,user3:null,error_off:"Sorry it doesn't appear any librarians are online... Please try again later.",wait:"Please wait... A librarian will connect shortly!",onlineRules:[{d:[],u:0,c:""}],widget_type:2,skip_login:!1,nologin_message:"Type your question in the box below and press Enter to start chatting.",autoload_time:0,autoload_head:"Do you need help?",autoload_text:"A librarian is online ready to help.",autoload_yes:"Chat Now",autoload_no:"No Thanks",missedchat_time:30,missedchat_message:"We apologize for the delay. Don't want to wait?",missedchat_link:"Submit your question.",error_message:"Sorry, it looks like you're having a connection issue. Would you like to submit your question for email follow-up?",error_link:"Submit your question.",away_message:"Chat is online but the operator is temporarily away.",away_link:"Submit your question.",reload_button:"Recheck Status",valid_form_q:"Please enter your question.",valid_form_n:"Please enter your name.",valid_form_c:"Please enter valid contact information.",fbwidget:!1,autopop:!1,question_text:"",contact_request:!1,contact_required:!1,contact_request_msg:"To help us be able to follow up with you, please enter an email address or sms number.",followup_enabled:!0,followup_msg:"If you wish to be followed up with via email or phone, submit a message below to create a new support ticket.",cal_offline:!1,cal_autoload:!1,cal_text:"Schedule a Meeting",cal_url:"",online_rule:!1,translation:{},domain:"",defaultProfile:"",dataNotice:"",greetingLocal:"",greetingCoop:"",timedFallback:0,authUrl:"",authText:"",authButton:"",isAuthValidated:!1},n.peel=!1,n.autologin=!1,n.client_question="",n.widget_types={button:1,embed:2,tab:3,float:6},n.referer="",n.referer_title="",n.loggedIn=!1,n.cascade=null,n.connected=!1,n.reconnect=!0,n.hasConnected=!1,n.hasSubscribed=!1,n.chatting=!1,n.ticketCreated=!1,n.answered=!1,n.peelingParent=!1,n.status_offline=0,n.status_online=1,n.status_away=2,n.initialize=function(t,e){this.init(t,e);const i=parseInt(this.get("widget_type"),10);this.set({widget_type:i},{silent:!0});for(let t=1;t<=3;t++){const e="user"+t,i=this.get(e),n=Object.create(s);null!==i&&n.init(i),this.set(e,n,{silent:!0})}},n.getFormUrl=function(){return`${this.get("domain")}/form?queue_id=${this.get("queue_id")}&pquestion=${encodeURIComponent(this.get("client_question"))}`},n.getFormLink=function(t){return`<a href="${this.getFormUrl()}" target="_blank">${t}</a>`},n.getMissedChatMessage=function(){let t="";const e=this.get("missedchat_message");if(""!==e&&(t+=e),!this.get("followup_enabled"))return t;const i=this.get("missedchat_link");return""!==i&&(t+="<br/><br/>"+this.getFormLink(i)),t},n.getErrorMessage=function(){let t=this.get("translation").ch_connect_error;if(this.get("followup_enabled"))return t;const e=this.get("error_link");return""!==e&&(t+="<br/><br/>"+this.getFormLink(e)),t},n.getOfflineMessage=function(){let t="";const e=this.get("error_off");if(""!==e&&(t+=e),!this.get("followup_enabled"))return t;if(this.get("contact_request"))return t;const i=this.get("error_link");return""!==i&&(t+="<br/><br/>"+this.getFormLink(i)),t},n.getAwayMessage=function(){let t="";const e=this.get("away_message");if(""!==e&&(t+=e),!this.get("followup_enabled"))return t;if(this.get("contact_request"))return t;const i=this.get("away_link");return""!==i&&(t+="<br/><br/>"+this.getFormLink(i)),t},n.isButton=function(){return parseInt(this.get("widget_type"),10)===this.get("widget_types").button},n.isFloat=function(){return parseInt(this.get("widget_type"),10)===this.get("widget_types").float},n.isTab=function(){return parseInt(this.get("widget_type"),10)===this.get("widget_types").tab},n.isEmbed=function(){return parseInt(this.get("widget_type"),10)===this.get("widget_types").embed},n.showPeelOutIcon=function(){return!this.get("peel")&&!this.isButton()},n.offlineLinkTarget=function(){return this.get("peel")||this.isButton()?"_blank":"_parent"},n.generateAnonName=function(){const t=Math.floor(99999999*Math.random());return this.get("guest_label")+t},n.validateContact=function(t){if(this.get("contact_required")&&""===t)return!1;if(""===t)return!0;if(null===t.match(e.email)){if(null===t.replace(/[\-\(\)\s\.]/g,"").match(e.phone))return!1}return!0},n.getOnlineDept=function(){const t=this.get("online_rule");return t?Array.isArray(t.d)?t.d[0]||{}:t.d||{}:{}},n.getPeelUrl=function(){return`/chat/widget/${this.get("hash")}?peel=true&referer=${this.get("referer")}`},n.focusOnLoad=function(){return!(this.get("widget_type")===this.get("widget_types").embed)},n.sanitizeMessage=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/(^|\s|&nbsp;)(https?:[^\s"\n]+?)([.,!]?(\s|\n|$|<|&nbsp;))/g,'$1<a href="$2" target="_blank">$2</a>$3')},n.getGreeting=function(t){return t?this.get("greetingLocal"):this.get("greetingCoop")},t.springSpace=t.springSpace||{},t.springSpace.chat=t.springSpace.chat||{},t.springSpace.chat.chatWidget=n}(this),function(t){const e=t.springyModel;if(void 0===e)throw new Error("chatSession requires springyModel");const i=t.springSpace.regex,s=Object.create(e),n=Object.create(s);n.defaults={sessionId:"",name:"",client_contact:"",role:"user",user_agent:"",isMobile:!1,ip:"",referer:"",client_question:"",did:-1,uid:0,coopId:"",widget:"",user1:"",user2:"",user3:"",consortium:"",isPeel:!1,peel:"",iid:0,joined:"",transferTarget:null,transferHist:[],isPending:!1,isConnected:!1,isAnswered:!1,ops:[],messages:[],isTyping:!1,isSelected:!1,newMessages:0,disconnectReason:"",popped:!1,region:"",site:{},fallbacks:[]},n.isInternal=!1,n.pendingTimeout=null,n.msgConsolidated=!1,n.getChannel=function(){return this.getRoom()},n.getRoom=function(){return"chat-"+this.get("sessionId")},n.setContactInfo=function(t){let e=t.trim();""!==e?null===e.match(i.email)?(e=e.replace(/[\-\(\)\s\.]/g,""),null===e.match(i.phone)||this.set("client_contact",e)):this.set("client_contact",e):this.set("client_contact","")},n.setDisconnectReason=function(t){switch(t.toLowerCase()){case"transport close":this.set("disconnectReason","Closed or left page.")}},n.addMessage=function(t){const e=this.get("messages");e.push(t);const i={messages:e};if(!this.get("isSelected")){let t=this.get("newMessages");t++,i.newMessages=t}this.set(i),this.trigger("chat:message",t)},n.resetContext=function(){this.set({newMessages:0,isSelected:!1,isTyping:!1},{silent:!0})},n.updateFromServer=function(t){const e={ops:t.ops,transferHist:t.transferHist,transferTarget:t.transferTarget,isAnswered:t.isAnswered,did:t.did,uid:t.uid,iid:t.iid,coopId:t.coopId||"",isConnected:!0};if(t.messages.length>0){const i=this.get("messages");if(0===i.length)e.messages=t.messages;else{const s=i[i.length-1];if(s.ts){const e=new Date(s.ts);t.messages.forEach((function(t){const s=new Date(t.ts);e>=s||(i.push(t),this.trigger("chat:message",t))}),this)}else e.messages=t.messages}}this.set(e),this.msgConsolidated=!1},n.setPendingTimeout=function(e){t.clearTimeout(this.pendingTimeout),this.pendingTimeout=t.setTimeout(e,6e4)},n.clearPendingTimeout=function(){t.clearTimeout(this.pendingTimeout)},n.isOpChatting=function(t){return-1!==this.ops.indexOf(t)},n.addOp=function(t,e){void 0===e&&(e=!1);const i=this.ops.indexOf(t);(-1===i||e)&&(0===this.ops.length&&(this.ops=[]),e?(-1!==i&&this.ops.splice(i,1),this.ops.unshift(t)):this.ops.push(t),this.trigger("change:ops"),this.trigger("change"))},n.removeOp=function(t){const e=this.ops.indexOf(t);return-1!==e&&(this.ops.splice(e,1),this.trigger("change:ops"),this.trigger("change"),!0)};const o=Object.create(s);o.defaults={sessionId:"",name:"",fullname:"",role:"op",opId:0,consortium:[],coopIds:[],siteName:"",iid:0,isAway:!1,profile_image:{path:"",color:""},deptsMonitored:[],deptsInternal:[],ip:"",joined:"",isConnected:!1,newDash:!1,currentUserChats:[],region:"",unitId:0,unitName:""},o.isShared=!1,o.awayTimeout=null,o.initialize=function(t,e){t.fullname&&""!==t.fullname||(t.fullname=t.name||""),this.init(t,e)},o.getRoom=function(){return"internal-"+this.get("sessionId")},o.getStatusText=function(){const t=this.get("isConnected"),e=this.get("isAway");return t?e?"away":0===this.get("deptsMonitored").length&&0===this.get("coopIds").length?"internal":"online":"offline"},o.addDept=function(t){this.get("deptsMonitored").includes(t)||this.get("deptsMonitored").push(t)},o.removeDept=function(t){const e=this.get("deptsMonitored").indexOf(t);-1!==e&&this.get("deptsMonitored").splice(e,1)},o.isMonitoringDept=function(t){return-1!==this.get("deptsMonitored").indexOf(t)},o.addCoop=function(t){this.get("coopIds").includes(t)||this.get("coopIds").push(t)},o.removeCoop=function(t){const e=this.get("coopIds").indexOf(t);-1!==e&&this.get("coopIds").splice(e,1)},o.isMonitoringCoop=function(t){return-1!==this.get("coopIds").indexOf(t)},o.addUser=function(t){const e=this.get("currentUserChats");-1===e.indexOf(t)&&e.push(t)},o.removeUser=function(t){const e=this.get("currentUserChats"),i=e.indexOf(t);-1!==i&&e.splice(i,1)},o.updateFromServer=function(t){const e={};t.sessionId&&(e.sessionId=t.sessionId),t.deptsMonitored&&(e.deptsMonitored=t.deptsMonitored),t.coopIds&&(e.coopIds=t.coopIds),void 0!==t.isAway&&(e.isAway=t.isAway),void 0!==t.isConnected&&(e.isConnected=t.isConnected),t.joined&&(e.joined=t.joined),t.profile_image&&(e.profile_image=t.profile_image),this.set(e)},o.setPendingTimeout=function(e){t.clearTimeout(this.awayTimeout),this.awayTimeout=t.setTimeout(e,6e4)},o.clearPendingTimeout=function(){t.clearTimeout(this.awayTimeout)},o.toJSON=function(){const t=e.toJSON.call(this);return t.status=this.getStatusText(),t},t.springSpace=t.springSpace||{},t.springSpace.chat=t.springSpace.chat||{},t.springSpace.chat.patronSession=n,t.springSpace.chat.opSession=o}(window),(springSpace=springSpace||{}).sui=springSpace.sui||{},springSpace.sui.storage_=function(){this.supported=!1,this.get=function(t){var e=null;return this.supported&&(e=localStorage.getItem(t)),null!==e?e:""},this.set=function(t,e){if(this.supported){try{localStorage.setItem(t,e)}catch(t){return!1}return!0}return!0},this.remove=function(t){this.supported&&localStorage.removeItem(t)},this.iterate=function(t){if(this.supported&&localStorage.length>0){for(var e=[],i=0;i<localStorage.length;i++)e.push(localStorage.key(i));if(e.length>0)for(i=0;i<e.length;i++)t.call(this,e[i])}};try{if(!("localStorage"in window)||null===window.localStorage)return;this.supported=!0}catch(t){return}},springSpace.sui.storage=new springSpace.sui.storage_,(springSpace=springSpace||{}).sui=springSpace.sui||{},springSpace.sui.filedrop=function(t){if(void 0===t)return!1;if(!t.selector||""===t.selector)return!1;var e;if(this.callback=t.callback?t.callback:function(){},this.error_callback=t.error_callback?t.error_callback:function(){},this.validate=t.validate?t.validate:function(){return!0},this.max_files=t.max_files?parseInt(t.max_files,10):0,this.max_upload_size=t.max_upload_size?parseInt(t.max_upload_size,10):0,this.max_file_size=t.max_file_size?parseInt(t.max_file_size,10):0,this.batch_files=void 0!==t.batch_files&&!!t.batch_files,this.autoupload=void 0===t.autoupload||!!t.autoupload,this.translations=t.translations?t.translations:{max_file_size:"Maximum file size"},this.allowedMimeTypes=t.allowedMimeTypes?t.allowedMimeTypes:[],this.isAdvancedUpload=("draggable"in(e=document.createElement("div"))||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window,this.$form=jQuery(t.selector),0===this.$form.length)return!1;this.$droparea=this.$form.find(".s-ui-filedrop"),this.droppedFiles=[],this.batchedFiles=[],this.batch={current:0,total:0};var i=this;if(this.$input=this.$droparea.find('input[type="file"]'),this.$label=this.$droparea.find("label"),this.$submitbutton=this.$form.find('button[type="submit"]'),this.$progress=null,this.showFiles=function(){if(0!==this.$input.length){var t=this.$droparea[0].querySelector(".s-ui-filedrop-filenames"),e=t.querySelector("ul");if(this.isAdvancedUpload){var s=[],n=0;this.droppedFiles.forEach((function(t){var e=document.createElement("li");e.innerText=t.name,s.push(e),n+=t.size})),e.innerHTML="",0===s.length?t.classList.add("hidden"):(t.classList.remove("hidden"),s.forEach((function(t){e.appendChild(t)}))),this.max_files>0&&s.length>this.max_files&&this.showError(i.max_files+" file uploads maximum."),!1===this.batch_files&&this.max_upload_size>0&&n>this.max_upload_size&&this.showError("Files total "+i.bytesToMB(n)+" MB which exceeds the maximum of "+i.bytesToMB(this.max_upload_size)+" MB at a time.")}else{if(""===this.$input.val())return t.classList.add("hidden"),void(e.innerHTML="");t.classList.remove("hidden");var o=document.createElement("li");o.innerText=this.$input.val().split("\\").slice(-1).pop(),e.appendChild(o),this.$label.find(".filetext").addClass("hidden")}}},this.reset=function(){i.$form[0].reset(),i.removeError(),i.droppedFiles=[],i.batch.current=0,i.batch.total=0,i.stopProgress(),i.showFiles(),i.$input.removeClass("has-focus")},this.clearFiles=function(){i.resetFileInput(),i.droppedFiles=[],i.batch.current=0,i.batch.total=0,i.showFiles()},this.resetFileInput=function(){if(0!==this.$input.length){var t=jQuery("<form>"),e=this.$input.clone(!0).appendTo(t);t[0].reset(),this.$input.replaceWith(e),this.$input=e}},this.showError=function(t){if(0!==this.$droparea.length){var e=document.createElement("p");if(e.innerText=t,this.$form.find("div.s-ui-filedrop-error").length>0)this.$form.find("div.s-ui-filedrop-error").append(e);else{var i=document.createElement("div");i.classList.add("alert"),i.classList.add("alert-danger"),i.classList.add("s-ui-filedrop-error"),i.setAttribute("role","alert"),i.appendChild(e),this.$droparea.prepend(i)}}},this.removeError=function(){this.$form.find("div.s-ui-filedrop-error").empty()},this.countFiles=function(){return 0===this.$input.length?0:this.isAdvancedUpload?this.droppedFiles.length:""!==this.$input.val()?1:0},this.startProgress=function(){if(null===this.$progress||1===this.$progress.length&&""===this.$progress.html()){var t=!0;this.$progress=this.$form.find("div.s-ui-filedrop-progress"),0===this.$progress.length&&(t=!1,this.$progress=jQuery("<div></div>").addClass("s-ui-filedrop-progress"));var e=jQuery("<div></div>").attr({id:"s-ui-filedrop-progresslabel"}).text("Uploading files"),i=jQuery("<div></div>").addClass("s-ui-filedrop-progbar").attr({role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100","aria-labelledby":"s-ui-filedrop-progresslabel"});i.append(document.createElement("span")),this.$progress.append([e,i]),t||this.$droparea.prepend(this.$progress)}},this.updateProgress=function(t,e){var i=Math.round(t/e*100);(this.$progress.find("span:first").css("width",i+"%"),this.$progress.find(".s-ui-filedrop-progbar").attr("aria-valuenow",i),this.batch.total>1&&i<50)&&this.$progress.find("div:first").html("Uploading file batch ("+this.batch.current+"/"+this.batch.total+")")},this.stopProgress=function(){null!==this.$progress&&this.$progress.empty()},this.bytesToMB=function(t){return(parseInt(t,10)/1048576).toFixed(1)},this.addFiles=function(t){if(i.max_files>0&&i.countFiles()+t.length>i.max_files)return i.showError(i.max_files+" file uploads maximum."),!1;var e=0;i.droppedFiles.forEach((function(t){e+=t.size}));for(var s=[],n=0;n<t.length;n++){var o=t[n];if(i.droppedFiles.length>0){var r=!1;if(i.droppedFiles.forEach((function(t){t.name===o.name&&(r=!0)})),r){s.push(n);continue}}this.allowedMimeTypes.length>0&&-1===this.allowedMimeTypes.indexOf(o.type)?(i.showError("File: "+o.name+" is not an allowed file type."),s.push(n)):i.max_file_size>0&&o.size>i.max_file_size?(i.showError("File: "+o.name+" is greater than allowed file size of "+i.bytesToMB(i.max_file_size)+" MB."),s.push(n)):!1===i.batch_files&&e+o.size>i.max_upload_size?(i.showError("File: "+o.name+" causes files to go over maximum upload size of "+i.bytesToMB(i.max_upload_size)+" MB at a time."),s.push(n)):e+=o.size}if(!1===i.batch_files&&i.max_upload_size>0&&e>i.max_upload_size)return i.showError("Files total "+e+" bytes which exceeds the maximum of "+i.bytesToMB(i.max_upload_size)+" MB at a time."),!1;for(var a=0;a<t.length;a++)-1===s.indexOf(a)&&i.droppedFiles.push(t[a]);return 0!==i.droppedFiles.length},this.batchFiles=function(){var t=[],e=[];if(!this.batch_files)return t.push(this.droppedFiles),t;var s=1;return t.push([]),e.push(0),this.droppedFiles.forEach((function(n){var o=!1;if(e.forEach((function(s,r){!o&&s+n.size<i.max_upload_size&&(e[r]=s+n.size,t[r].push(n),o=!0)})),!o){e.push(0),s++,t.push([]);var r=s-1;e[r]=n.size,t[r].push(n)}})),t},this.isLastBatch=function(){return this.batch.current>=this.batch.total},this.ajaxUpload=function(){i.$form.find('input[name="batch_current"]').val(i.batch.current);var t=new FormData(i.$form[0]);"function"==typeof t.delete&&t.delete(i.$input.attr("name")),i.batchedFiles[i.batch.current-1].forEach((function(e){t.append(i.$input.attr("name"),e)})),jQuery.ajax({url:i.$form.attr("action"),type:i.$form.attr("method"),data:t,dataType:"json",cache:!1,crossDomain:!0,contentType:!1,processData:!1,beforeSend:function(){i.countFiles()>0&&i.startProgress()},complete:function(){i.isLastBatch()?(i.$form.removeClass("is-uploading"),i.$submitbutton.prop("disabled",!1),i.stopProgress()):(i.batch.current++,i.ajaxUpload())},success:function(t){i.callback(t,i)},xhr:function(){var t=jQuery.ajaxSettings.xhr();return i.countFiles()>0&&(t.upload.onprogress=function(t){i.updateProgress(t.loaded,t.total)}),t}}).fail((function(t){i.error_callback(t,i)}))},this.isAdvancedUpload&&this.$input.length>0){if(this.$droparea.addClass("has-advanced-upload"),this.batch_files){var s=jQuery("<input />").attr({type:"hidden",name:"batch_current"}).val("0"),n=jQuery("<input />").attr({type:"hidden",name:"batch_total"}).val("0");this.$form.prepend([s,n])}this.$droparea.on("drag dragstart dragend dragover dragenter dragleave drop",(function(t){t.preventDefault(),t.stopPropagation()})).on("dragover dragenter",(function(){i.$droparea.addClass("is-dragover")})).on("dragleave dragend drop",(function(){i.$droparea.removeClass("is-dragover")})).on("drop",(function(t){var e=i.addFiles(t.originalEvent.dataTransfer.files);i.showFiles(),!0===e&&i.autoupload&&i.$form.submit()})).on("click",(function(t){var e=t.target.tagName;-1!==["A","I","SPAN","B","STRONG","BUTTON"].indexOf(e)&&(jQuery(t.target).closest("a, button").hasClass("s-ui-filedrop-clear")&&(i.clearFiles(),i.removeError()))}))}if(this.isAdvancedUpload||(this.$input.remove(),this.$droparea.remove()),this.$input.length>0&&(this.$input.on("change",(function(t){if(t.target.files){if(i.isAdvancedUpload){var e=i.addFiles(t.target.files);i.resetFileInput(),!0===e&&i.autoupload&&i.$form.submit()}i.$input.removeClass("has-focus"),i.showFiles()}})).on("focus",(function(t){t.target.classList.add("has-focus")})).on("blur",(function(t){t.target.classList.remove("has-focus")})),this.translations.max_file_size)){var o=document.createElement("p");o.innerHTML=this.translations.max_file_size+": "+this.bytesToMB(this.max_file_size)+" MB",this.$label.append(o)}this.$form.on("submit",(function(t){if(i.$form.hasClass("is-uploading"))t.preventDefault();else{if(i.$form.removeClass("is-error"),i.removeError(),i.max_files>0&&i.countFiles()>i.max_files)return i.showError(i.max_files+" file uploads maximum."),void t.preventDefault();if(!1===i.validate(i))return i.$form.addClass("is-error"),void t.preventDefault();i.$form.addClass("is-uploading"),i.$submitbutton.prop("disabled",!0),i.isAdvancedUpload?(t.preventDefault(),i.batch.current=1,i.batchedFiles=i.batchFiles(),i.batch.total=i.batchedFiles.length,i.$form.find('input[name="batch_total"]').val(i.batch.total),i.ajaxUpload()):(t.preventDefault(),jQuery.ajax({url:i.$form.attr("action"),type:i.$form.attr("method"),data:i.$form.serialize(),dataType:"json",complete:function(){i.$form.removeClass("is-uploading"),i.$submitbutton.prop("disabled",!1)},success:function(t){i.callback(t,i)}}).fail((function(t){i.error_callback(t,i)})))}}))},function(t){const e={input:null,list:null,listLabel:"Suggested results",instructions:null,throttle:null,xhrSearch:null,queryName:"",queryProcessor:null,dataProcessor:null,selectCallback:null,typedQuery:"",resultLimit:10,queryData:{},staticData:[],preventSubmit:!1,instructionsText:"{{count}} options available. Use up and down arrows to browse available options and enter to select one.",showAllOnFocus:!1,allowEmptySearch:!1,selectNext:function(){const t=this.list.querySelector("li[aria-selected=true]");let e=null;if(null===t){if(e=this.list.querySelector("li:first-of-type"),null===e)return}else{if(e=t.nextElementSibling,null===e)return;t.setAttribute("aria-selected",!1)}e.setAttribute("aria-selected",!0),this.input.value=e.textContent},selectPrevious:function(){const t=this.list.querySelector("li[aria-selected=true]");if(null===t)return;const e=t.previousElementSibling;null===e?this.input.value=this.typedQuery:(e.setAttribute("aria-selected",!0),this.input.value=e.textContent),t.setAttribute("aria-selected",!1)},selectByClick:function(t){const e=this.list.querySelector("li[aria-selected=true]");null!==e&&e.setAttribute("aria-selected",!1),t.setAttribute("aria-selected",!0),this.selectOption(),this.showAllOnFocus||this.input.focus()},escapeRegExp:function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},formatOption:function(t){let e="";if(t.display)e=t.display;else{const i=new RegExp(`(${this.escapeRegExp(this.typedQuery)})`,"ig");e=t.label.replace(i,"<strong>$1</strong>")}if(!e)return null;const i=document.createElement("li");return i.setAttribute("aria-selected",!1),i.setAttribute("role","option"),Object.keys(t).forEach(e=>{"label"!==e&&"display"!==e&&(i.dataset[e]=t[e])}),i.innerHTML=e,i},displayResults:function(t){if(0===t.length)return void this.closeList();let e=t.map(this.formatOption,this);e.length>this.resultLimit&&!this.allowEmptySearch&&(e=e.slice(0,this.resultLimit)),this.list.innerHTML="";const i=document.createDocumentFragment();e.forEach(t=>{t&&i.appendChild(t)}),this.list.appendChild(i),this.updateInstructions(e.length),this.openList()},isListOpen:function(){return!this.list.classList.contains("hidden")},isOptionSelected:function(){return null!==this.list.querySelector("li[aria-selected=true]")},openList:function(){this.list.style.left=this.input.offsetLeft+"px",this.list.style.top=this.input.offsetTop+this.input.offsetHeight+"px",this.list.style.minWidth=this.input.offsetWidth+"px",this.list.classList.remove("hidden"),this.input.setAttribute("aria-expanded",!0)},closeList:function(){this.list.classList.add("hidden"),this.list.innerHTML="",this.input.setAttribute("aria-expanded",!1),this.updateInstructions(0)},selectOption:function(){const t=this.list.querySelector("li[aria-selected=true]");this.input.value=t.textContent,null!==this.selectCallback&&this.selectCallback(t),this.closeList()},processData:function(t){return null!==this.dataProcessor?this.dataProcessor(t):t},buildQueryString:function(){const t=this.input.value,e=null!==this.queryProcessor?this.queryProcessor(t):t,i=new URLSearchParams;i.append(this.queryName,e),i.append("limit",this.resultLimit);return Object.keys(this.queryData).forEach((function(t){const e=this.queryData[t];if("function"==typeof e)return i.append(t,e()),void(this.queryData[t]=e());i.append(t,e)}),this),"?"+i.toString()},xhrOnLoad:function(){if(this.xhrSearch.status>=200&&this.xhrSearch.status<400){const t=JSON.parse(this.xhrSearch.responseText),e=this.processData(t);this.displayResults(e)}else console.log(this.xhrSearch.statusText)},xhrOnError:function(){console.log(this.xhrSearch.statusText)},makeRequest:function(){const t=this.buildQueryString();this.xhrSearch=new XMLHttpRequest,this.xhrSearch.open("GET",this.queryUrl+t,!0),this.xhrSearch.setRequestHeader("Accept","application/json"),this.xhrSearch.onload=this.xhrOnLoad.bind(this),this.xhrSearch.onerror=this.xhrOnError.bind(this),this.xhrSearch.send()},searchData:function(){const t=this.input.value;if(""===t&&!this.allowEmptySearch)return void this.closeList();let e=null!==this.queryProcessor?this.queryProcessor(t):t;if(e=e.toLowerCase(),""===e)return void this.displayResults(this.staticData);const i=this.staticData.filter(t=>-1!==t.label.toLowerCase().indexOf(e));this.displayResults(i)},getExactMatch:function(){const t=this.input.value.trim().toLowerCase();if(""===t)return null;const e=this.staticData.find(e=>e.label.toLowerCase()===t);return e||null},query:function(){this.staticData.length>0?this.searchData():(this.throttle&&clearTimeout(this.throttle),this.xhrSearch&&this.xhrSearch.abort(),""!==this.input.value||this.allowEmptySearch?this.throttle=setTimeout(this.makeRequest.bind(this),500):this.closeList())},disable:function(){this.list.parentNode.removeChild(this.list)},createList:function(){this.list=document.createElement("ul"),this.list.id=this.getListId(),this.list.setAttribute("role","listbox"),this.list.setAttribute("aria-label",this.listLabel),this.list.classList.add("s-ui-autocomplete-list"),this.list.classList.add("hidden"),this.input.parentNode.insertBefore(this.list,this.input.nextSibling)},getListId:function(){return this.input.id+"_list"},getInstructionsId:function(){return this.input.id+"_instructions"},formatInput:function(){this.input.setAttribute("role","combobox"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls",this.getListId()),this.input.setAttribute("aria-describedby",this.getInstructionsId()),this.input.setAttribute("autocomplete","off"),this.queryName=this.input.getAttribute("name")},updateInstructions:function(t){this.instructions.innerHTML=this.instructionsText.replace("{{count}}",t)},handleTypingDown:function(t){const e=this.isListOpen();switch(t.key){case"Escape":e&&this.closeList();break;case"ArrowDown":e?(t.preventDefault(),this.selectNext()):this.showAllOnFocus&&""===this.input.value&&this.query();break;case"ArrowUp":e&&(t.preventDefault(),this.selectPrevious());break;case"Enter":e&&this.isOptionSelected()?(t.preventDefault(),this.selectOption()):this.preventSubmit&&t.preventDefault();break;case"Tab":e&&this.isOptionSelected()?this.selectOption():e&&this.closeList()}},handleTypingUp:function(t){switch(t.key){case"Escape":case"ArrowDown":case"ArrowUp":case"ArrowLeft":case"ArrowRight":case"Enter":case"Tab":break;default:this.typedQuery=this.input.value,this.query()}},handleClick:function(t){const e=t.target.closest("li[aria-selected=false]");null!==e&&this.selectByClick(e)},handleOutsideClick:function(t){const e=t.target;null!==e.closest("#"+this.list.id)||null!==e.closest("#"+this.input.id)||this.closeList()},attachEvents:function(){this.input.addEventListener("keydown",this.handleTypingDown.bind(this)),this.input.addEventListener("keyup",this.handleTypingUp.bind(this)),this.list.addEventListener("click",this.handleClick.bind(this)),document.body.addEventListener("click",this.handleOutsideClick.bind(this)),this.showAllOnFocus&&this.input.addEventListener("focus",()=>{""===this.input.value&&this.query()})},addInstructions:function(){this.instructions=document.createElement("div"),this.instructions.id=this.getInstructionsId(),this.instructions.setAttribute("aria-live","assertive"),this.instructions.classList.add("sr-only"),this.instructions.innerHTML=this.instructionsText.replace("{{count}}",0),this.list.parentNode.insertBefore(this.instructions,this.list.nextSibling)},validateConfig:function(t){if(!t.inputSelector)throw new Error("Must set inputSelector.");if(null===this.input)throw new Error(t.inputSelector+" not found in the DOM.");if(!this.queryUrl&&0===this.staticData.length)throw new Error("Must set queryUrl or staticData.")},setConfig:function(t){this.input=document.querySelector(t.inputSelector);const e=["queryUrl","staticData","queryProcessor","dataProcessor","selectCallback","resultLimit","queryData","instructionsText","preventSubmit","listLabel","showAllOnFocus","allowEmptySearch"];Object.keys(t).forEach((function(i){-1!==e.indexOf(i)&&(this[i]=t[i])}),this),this.showAllOnFocus&&(this.allowEmptySearch=!0)},init:function(t){this.setConfig(t),this.validateConfig(t),this.formatInput(),this.createList(),this.addInstructions(),this.attachEvents()}},i=function(t){const i=Object.create(e);return i.init(t),i};"undefined"!=typeof module?module.exports=e:(t.springSpace=t.springSpace||{},t.springSpace.sui=t.springSpace.sui||{},t.springSpace.sui.initAutocomplete=t.springSpace.sui.initAutocomplete||i)}(this),function(t){var e="undefined"!=typeof require;if(void 0===(i=t.$)){if(!e)throw new Error("springyView requires jQuery");var i=require("jQuery")}var s={el:null,$el:null,id:"",tagName:"div",className:"",model:null,events:{},listeners:{},templateEng:null,templates:{main:function(){return""}},init:function(t){void 0===t&&(t={}),Object.keys(t).forEach((function(e){"events"!==e&&"listeners"!==e?this[e]=t[e]:Object.keys(t[e]).forEach((function(i){this[e][i]=t[e][i]}),this)}),this),this.initElement(),this.registerEvents(this.events),this.registerListeners(this.listeners)},generateElement:function(){if(!this.id)throw Error("springyView el must have an id.");this.el=document.createElement(this.tagName),this.el.id=this.id,this.$el=i(this.el),""!==this.className&&this.$el.addClass(this.className)},checkElementConfig:function(){if(null===this.el&&null===this.$el&&!this.id)throw Error("springyView el, $el, or id must be set.");if(null===this.el&&null===this.$el){var t=i("#"+this.id);if(0===t.length)return void this.generateElement();this.$el=t}},initElement:function(){if(this.checkElementConfig(),null===this.el?this.el=this.$el[0]:null===this.$el&&(this.$el=i(this.el)),this.id=this.el.id,!this.id)throw Error("springyView el must have an id.");this.tagName=this.el.tagName,this.className=this.$el.attr("class")},registerEvents:function(t){Object.keys(t).forEach((function(e){this.addEvent(e,t[e])}),this)},addEvent:function(t,e){this.events[t]||(this.events[t]=e),"function"!=typeof e&&(e=this[e].bind(this));var i=t.match(/^(\S+)\s*(.*)$/i),s=i[1],n=i[2];this.$el.on(s+".viewDelegated-"+this.id,n,e)},unregisterEvents:function(){Object.keys(this.events).forEach((function(t){var e=t.match(/^(\S+)\s*(.*)$/i)[1];this.$el.on(e+".viewDelegated-"+this.id)}),this),this.events={}},registerListeners:function(t){Object.keys(t).forEach((function(e){this.listen(e,t[e])}),this)},listen:function(t,e){this.model&&this.model.emitter&&(this.listeners[t]=e,e.split(" ").forEach((function(e){this.model.emitter.on(t,this[e],this)}),this))},stopListening:function(){this.model&&this.model.emitter?(Object.keys(this.listeners).forEach((function(t){this.listeners[t].split(" ").forEach((function(e){this.model.emitter.off(t,this[e])}),this)}),this),this.listeners={}):this.listeners={}},remove:function(){this.unregisterEvents(),this.stopListening(),this.$el.remove()},render:function(){return this}};"undefined"!=typeof module?module.exports=s:this.springyView=s}(this),function(t){var e={dragElement:null,handleSelector:null,resizeSelector:null,startX:null,startY:null,startPosX:null,startPosY:null,startWidth:null,startHeight:null,minWidth:null,minHeight:null,doDragCallback:null,stopDragCallback:null,doResizeCallback:null,stopResizeCallback:null,enabled:!1,callbackStartDrag:null,getX:function(t){return 0===t.type.toLowerCase().indexOf("touch")?t.touches[0].clientX:t.clientX},getY:function(t){return 0===t.type.toLowerCase().indexOf("touch")?t.touches[0].clientY:t.clientY},doDrag:function(t){t.preventDefault(),this.dragElement.style.left=this.startPosX+(this.getX(t)-this.startX)+"px",this.dragElement.style.top=this.startPosY+(this.getY(t)-this.startY)+"px",this.dragElement.style.bottom="auto",this.dragElement.style.right="auto"},stopDrag:function(){var t=this.dragElement.offsetWidth,e=parseInt(window.innerWidth,10),i=parseInt(window.innerHeight,10);parseInt(this.dragElement.style.left,10)<-(t-100)&&(this.dragElement.style.left=0),parseInt(this.dragElement.style.left,10)>e-50&&(this.dragElement.style.left=e-t+"px"),parseInt(this.dragElement.style.top,10)<0&&(this.dragElement.style.top="0px"),parseInt(this.dragElement.style.top,10)>i-50&&(this.dragElement.style.top=i-100+"px"),document.documentElement.removeEventListener("mousemove",this.doDragCallback,!1),document.documentElement.removeEventListener("touchmove",this.doDragCallback,!1),document.documentElement.removeEventListener("mouseup",this.stopDragCallback,!1),document.documentElement.removeEventListener("touchend",this.stopDragCallback,!1)},initDrag:function(t){if(!(t.button>1||"BUTTON"===t.target.tagName||t.target.closest("button"))&&t.target.closest(this.handleSelector)){if(t.preventDefault(),t.stopPropagation(),this.startX=this.getX(t),this.startY=this.getY(t),this.startPosX=parseInt(window.getComputedStyle(this.dragElement).left,10),this.startPosY=parseInt(window.getComputedStyle(this.dragElement).top,10),isNaN(this.startPosY)){var e=this.dragElement.getBoundingClientRect();this.startPosY=Math.ceil(e.top)}null!==this.callbackStartDrag&&this.callbackStartDrag(this.dragElement,this.handleSelector),document.documentElement.addEventListener("mousemove",this.doDragCallback,!1),document.documentElement.addEventListener("touchmove",this.doDragCallback,!1),document.documentElement.addEventListener("mouseup",this.stopDragCallback,!1),document.documentElement.addEventListener("touchend",this.stopDragCallback,!1)}},disableDrag:function(){if(this.enabled){this.dragElement.removeEventListener("mousedown",this.initDragBound,!1),this.dragElement.removeEventListener("touchstart",this.initDragBound,!1);var t=this.dragElement.querySelector(this.handleSelector);if(null!==t&&(t.style.cursor="auto"),this.enabled=!1,this.resizeSelector)null!==this.dragElement.querySelector(this.resizeSelector)&&(this.dragElement.removeEventListener("mousedown",this.initResizeBound,!1),this.dragElement.removeEventListener("touchstart",this.initResizeBound,!1))}},enableDrag:function(){if(!this.enabled){this.dragElement.addEventListener("mousedown",this.initDragBound,!1),this.dragElement.addEventListener("touchstart",this.initDragBound,!1);var t=this.dragElement.querySelector(this.handleSelector);if(null!==t&&(t.style.cursor="move"),this.enabled=!0,this.resizeSelector)null!==this.dragElement.querySelector(this.resizeSelector)&&(this.dragElement.addEventListener("mousedown",this.initResizeBound,!1),this.dragElement.addEventListener("touchstart",this.initResizeBound,!1))}},doResize:function(t){t.preventDefault();var e=this.startWidth+this.getX(t)-this.startX,i=this.startHeight+this.getY(t)-this.startY;e<this.minWidth&&(e=this.minWidth),i<this.minHeight&&(i=this.minHeight),this.dragElement.style.height=i+"px",this.dragElement.style.width=e+"px"},stopResize:function(){document.documentElement.removeEventListener("mousemove",this.doResizeCallback,!1),document.documentElement.removeEventListener("touchmove",this.doResizeCallback,!1),document.documentElement.removeEventListener("mouseup",this.stopResizeCallback,!1),document.documentElement.removeEventListener("touchend",this.stopResizeCallback,!1)},initResize:function(t){t.button>1||t.target.closest(this.resizeSelector)&&(t.preventDefault(),this.startX=this.getX(t),this.startY=this.getY(t),this.startWidth=parseInt(window.getComputedStyle(this.dragElement).width,10),this.startHeight=parseInt(window.getComputedStyle(this.dragElement).height,10),document.documentElement.addEventListener("mousemove",this.doResizeCallback,!1),document.documentElement.addEventListener("touchmove",this.doResizeCallback,!1),document.documentElement.addEventListener("mouseup",this.stopResizeCallback,!1),document.documentElement.addEventListener("touchend",this.stopResizeCallback,!1))},init:function(t){t.dragSelector&&t.handleSelector&&(this.dragElement=document.querySelector(t.dragSelector),null!==this.dragElement&&(this.handleSelector=t.handleSelector,this.resizeSelector=t.resizeSelector,"function"==typeof t.callbackStartDrag&&(this.callbackStartDrag=t.callbackStartDrag),this.minWidth=t.minWidth||0,this.minHeight=t.minHeight||0,this.initDragBound=this.initDrag.bind(this),this.doDragCallback=this.doDrag.bind(this),this.stopDragCallback=this.stopDrag.bind(this),this.initResizeBound=this.initResize.bind(this),this.doResizeCallback=this.doResize.bind(this),this.stopResizeCallback=this.stopResize.bind(this),this.enableDrag()))}};"undefined"!=typeof module?module.exports=e:(t.springSpace=t.springSpace||{},t.springSpace.dragger=e)}(this),function(t){const e=t.$,i=t._,s=Object.create(t.springyView);s.initialize=function(t){t.$el=e("#autoload"),this.init(t),this.templates.main=i.template(e("#template-chat-autoload").html())},s.getOnlineProfile=function(){const t=this.model.get("online_rule");if(t.u||""!==t.c)return{name:"",image:"",color:""};const e=this.model.getOnlineDept();return{name:e.name,image:e.image,color:e.color}},s.hideView=function(){this.$el.addClass("hidden")},s.showView=function(){this.$el.removeClass("hidden")},s.isShowing=function(){return!this.$el[0].classList.contains("hidden")},s.render=function(){this.$el.empty();const t={profile:this.getOnlineProfile(),autoload_head:this.model.get("autoload_head"),autoload_text:this.model.get("autoload_text"),autoload_yes:this.model.get("autoload_yes"),autoload_no:this.model.get("autoload_no"),cal_autoload:this.model.get("cal_autoload"),cal_url:this.model.get("cal_url"),cal_text:this.model.get("cal_text")};this.$el.html(this.templates.main(t));const i=this.model.offlineLinkTarget();return this.$el.find("a").each((t,s)=>{void 0===e(s).attr("target")&&e(s).attr("target",i)}),this},t.springSpace=t.springSpace||{},t.springSpace.chat=t.springSpace.chat||{},t.springSpace.chat.chatWidgetAutoView=s}(window),function(t){const e=t.$,i=t._,s=Object.create(t.springyView);s.initialize=function(t){t.$el=e("#libauth"),this.init(t),this.templates.main=i.template(e("#template-chat-libauth").html())},s.hideView=function(){this.$el.addClass("hidden")},s.showView=function(){this.$el.removeClass("hidden")},s.render=function(){this.$el.empty();const t={auth_id:this.model.get("auth_id"),isAuthValidated:this.model.get("isAuthValidated"),authText:this.model.get("authText"),authUrl:this.model.get("authUrl"),authButton:this.model.get("authButton")};if(this.$el.html(this.templates.main(t)),window!==window.top){const t=this.$el[0].querySelector(".btn-libauth");t&&t.setAttribute("target","_blank")}return this},t.springSpace=t.springSpace||{},t.springSpace.chat=t.springSpace.chat||{},t.springSpace.chat.chatWidgetAuthView=s}(this),function(t){const e=t.$,i=t._,s=Object.create(t.springyView);s.patronSession=null,s.templates={main:null},s.events={"submit form":"processLoginForm","click .s-lch-btn-close":"handleCancelClick"},s.listeners={chatError:"showLoginError",chatBlockedError:"showLoginError"},s.initialize=function(t){t.patronSession&&(this.patronSession=t.patronSession),t.$el=e("#login"),this.init(t),this.templates.main=i.template(e("#template-login-panel").html())},s.validateName=function(){const t=this.$form.find("input[name=client_name]");let e=t.val().trim();if(!0===this.model.get("autologin"))e=this.model.generateAnonName();else if(""===e&&!this.model.get("autologin")){if(!this.model.get("enable_anon"))return this.showValidationError(t,this.model.get("valid_form_n")),t.focus(),!1;e=this.model.generateAnonName(),t.val(e)}return this.patronSession.set("name",e),!0},s.validateContact=function(){if(this.model.get("contact_request")){const t=this.$form.find("input[name=client_contact]"),e=t.val().trim();if(!this.model.validateContact(e))return this.showValidationError(t,this.model.get("valid_form_c")),t.focus(),!1;this.patronSession.setContactInfo(e)}return!0},s.validateQuestion=function(){const t=this.$form.find("textarea[name=client_question]"),e=1===t.length?t.val().trim():"";return this.model.get("initial_question")&&!this.model.get("autologin")&&""===e?(this.showValidationError(t,this.model.get("valid_form_q")),t.focus(),!1):(this.patronSession.set("client_question",this.model.sanitizeMessage(e)),this.model.set("client_question",this.patronSession.get("client_question")),!0)},s.parseCustomFields=function(){for(let t=1;t<=3;t++){const e="user"+t,i=this.model.get(e);if(1===Number(i.get("show"))){const t=this.$form.find("#s-lch-"+e).val().trim();this.patronSession.set(e,{name:i.get("name"),val:t})}}},s.processLoginForm=function(t){if(t.preventDefault(),this.$submitButton.prop("disabled",!0),this.$form.find(".s-lch-form-error").remove(),!this.validateName()||!this.validateContact()||!this.validateQuestion())return this.$submitButton.prop("disabled",!1),!1;this.parseCustomFields();const e=this.$form.find("*[name=opId]"),i=this.$form.find("*[name=dept]");return e.length>0&&this.patronSession.set("uid",Number(e.val())),this.patronSession.get("uid")<1&&i.length>0&&this.patronSession.set("did",Number(i.val())),this.model.set("loggedIn",!0),!0},s.showLoginError=function(t=""){const e=t||this.model.getErrorMessage();this.$form.replaceWith(`<p class="alert alert-danger">${e}</p>`)},s.handleCancelClick=function(){this.model.emitter.trigger("closeWidget")},s.showValidationError=function(t,e){""!==e&&t.prev("label").append(`<span class="text-danger s-lch-form-error">${e}</span>`)},s.showView=function(){if(this.$el.removeClass("hidden"),this.model.get("auth_id")>0&&!this.model.get("isAuthValidated"))return this.$el[0].querySelectorAll("input,select,button,textarea").forEach(t=>{t.disabled=!0}),void this.$el[0].setAttribute("aria-hidden","true");if(this.model.isEmbed())return;const t=this.el.querySelector("input, textarea, select, a, button, [tabindex]");t&&t.focus()},s.render=function(){this.$el.empty();const t=this.model.toJSON();return t.patron=this.patronSession.toJSON(),this.$el.html(this.templates.main(t)),this.$form=this.$el.find("#s-lch-login-form"),this.$submitButton=this.$form.find("button[type=submit]"),this},"undefined"!=typeof module?module.exports=s:(t.springSpace=t.springSpace||{},t.springSpace.chat=t.springSpace.chat||{},t.springSpace.chat.chatWidgetLoginView=s)}(this),function(t){const e=t.$,i=t._,s=Object.create(t.springyView);s.patronSession=null,s.operatorsList=[],s.currentTypers=[],s.templates={main:null,sys:null,patron:null,op:null,contact:null,rating:null},s.events={"click .s-lch-btn-sound":"toggleSoundButton","keyup #s-lch-post-input":"patronTyping","keydown #s-lch-post-input":"triggerSubmitOnEnter","submit #s-lch-post-form":"messageSubmit","click .s-lch-btn-trans":"sendTranscript","click .s-lch-header-end .s-lch-btn-close":"closeWidget","click #s-lch-rate-form .s-lch-btn-close":"reloadCloseChat","click .s-lch-msg-op a":"followLink","click a.s-la-cfile[data-preview]":"showFileUploadPreview","click a":"openNewTab"},s.listeners={opJoin:"showOpJoin",opLeave:"showOpLeave",opAway:"showOpAway",endChat:"endChatDisplay",chatSubscribe:"chatSubscribeDisplay",chatReconnecting:"showReconnecting",chatReconnected:"showReconnected",chatError:"showChatError",chatBlockedError:"showBlockedError",requestContact:"showContactRequestForm",chatAway:"showChatAwayStatus",patronMessagePosted:"showPatronMessage","change:chatting":"enableChatting","change:peelingParent":"peeledOutDisplay","change:connected":"setConnectState",showGreeting:"showGreeting",deptGreeting:"showDeptGreeting",chatMsgNotSendable:"showMessageNotSendable"},s.missedChatTime=null,s.timedFallbackTime=null,s.initialize=function(t){t.patronSession&&(this.patronSession=t.patronSession),t.emitter&&(this.emitter=t.emitter),t.operatorsList&&(this.operatorsList=t.operatorsList),t.$el=e("#chat"),this.init(t),this.templates.main=i.template(e("#template-chat-panel").html()),this.templates.sys=i.template(e("#template-chat-sys-msg").html()),this.templates.patron=i.template(e("#template-chat-patron-msg").html()),this.templates.op=i.template(e("#template-chat-op-msg").html()),this.templates.contact=i.template(e("#template-chat-contact").html()),this.templates.rating=i.template(e("#template-chat-rating").html())},s.patronTyping=function(t){if(t.key&&"Enter"===t.key)return;const i=""!==e(t.target).val().trim();this.emitter.trigger("isTyping",i)},s.triggerSubmitOnEnter=function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),this.$form.trigger("submit"))},s.messageSubmit=function(t){t.preventDefault();const e=this.$msgInput.val().trim();this.emitter.trigger("messageSubmit",e)},s.clearTextarea=function(t){this.$msgInput.val(""),t&&this.$msgInput.focus()},s.followLink=function(t){const e=t.currentTarget;""!==(e.href?e.href:"")||t.preventDefault()},s.showChatMsg=function(t){if(!t.msg)return;let e="";t.id=t.id?t.id:"",t.opId=t.opId?t.opId:0,t.ts=t.ts?new Date(t.ts):new Date,t.ts_html="",t.ts_time="",void 0===t.show_meta&&(t.show_meta=this.checkShowMeta(t.role,t.ts,t.opId)),""!==t.ts&&"Invalid Date"!==t.ts&&(t.ts_html=this.htmlTime(t.ts),t.ts_time=t.ts.toLocaleTimeString()),"user"===t.role?(t.name=this.model.get("translation").ch_user_pronoun,e=this.templates.patron(t)):"op"===t.role&&(t.profile_image=t.profile_image?t.profile_image:{path:"",color:""},e=this.templates.op(t)),this.$log.append(e)},s.checkShowMeta=function(t,e,i){void 0!==e&&"Invalid Date"!==e||(e=new Date);let s="";switch(t){case"op":s="s-lch-msg-op-"+i;break;case"user":s="s-lch-msg-patron";break;case"sys":s="s-lch-msg-sys";break;default:return!0}const n=this.$log.find(".s-lch-msg:last");if(0===n.length)return!0;if(n.hasClass(s)){const t=n.find("time");if(t.length>0){const i=new Date(t.attr("pubdate"));if(this.checkMinuteDiff(e,i,5))return!0}return!1}return!0},s.checkMinuteDiff=function(t,e,i){let s=Math.abs(t-e);return s=Math.round(s/1e3/60),s>=i},s.showChatSysMsg=function(t){if(t.msg){if(t.id=t.id?t.id:"",t.ts=t.ts?new Date(t.ts):new Date,""!==t.ts&&"Invalid Date"!==t.ts&&(t.ts_html=this.htmlTime(t.ts),t.ts_time=t.ts.toLocaleTimeString()),t.show_meta=this.checkShowMeta("sys",t.ts),""!==t.id){const e=this.$log.find("#"+t.id);1===e.length&&e.remove()}this.$log.append(this.templates.sys(t)),this.scrollLog()}},s.htmlTime=function(t){let e="";return e+=(t=new Date(t)).getFullYear()+"-",e+=(t.getMonth()<9?"0":"")+(t.getMonth()+1)+"-",e+=(t.getDate()<10?"0":"")+t.getDate(),e+="T"+(t.getHours()<10?"0":"")+t.getHours()+":",e+=(t.getMinutes()<10?"0":"")+t.getMinutes()+":",e+=(t.getSeconds()<10?"0":"")+t.getSeconds(),e+=(-t.getTimezoneOffset()<0?"-":"+")+(Math.abs(t.getTimezoneOffset()/60)<10?"0":"")+Math.abs(t.getTimezoneOffset()/60)+":00",e},s.scrollLog=function(){try{this.$log.animate({scrollTop:this.$log.prop("scrollHeight")},1e3)}catch(t){}},s.showFileUpload=function(t){this.showChatMsg({msg:t,name:"You",role:"user"}),this.scrollLog(),this.$msgInput.focus()},s.contactSave=function(t){t.preventDefault(),this.$contactForm.find(".s-lch-form-error").remove();const e=this.$contactForm.find("input[name=client_contact]"),i=e.val().trim();if(!this.model.validateContact(i))return void this.showValidationError(e,this.model.get("valid_form_c"));this.patronSession.setContactInfo(i);const s=this.$contactForm.find("input[name=client_name]");if(s.length>0){const t=s.val().trim();if(!1===this.model.get("enable_anon")&&""===t)return void this.showValidationError(s,this.model.get("valid_form_n"));""!==t&&this.patronSession.set("name",t)}for(let t=1;t<=3;t++){const e="user"+t,i=this.model.get(e);if(1===Number(i.get("show"))){const t=this.$contactForm.find("#s-lch-"+e);if(t.length>0){const s=t.val().trim();this.patronSession.set(e,{name:i.get("name"),val:s})}}}if(this.$contactForm.find("button[type=submit], input").prop("disabled",!0),null===this.model.get("cascade"))return this.$contactForm.find("form").html("<p>Thank you.</p>"),this.$msgInput.focus(),void this.emitter.trigger("startSession");this.emitter.trigger("contactSave",this.$contactForm.find("form"))},s.contactFormSuccess=function(){this.$contactForm.find("form").html(`<p>${this.model.get("translation").ch_contact_info_saved}</p>`),this.$msgInput.focus(),""!==this.$msgInput.val()&&this.$form.submit()},s.contactSaveError=function(){this.$contactForm.append("<p>An error occurred and we were not able to save your contact information.</p>"),this.$contactForm.find("button[type=submit], input").prop("disabled",!1)},s.showContactRequestForm=function(t){if(""!==this.patronSession.get("client_contact"))return;void 0===t&&(t=!1),null!==this.$contactForm&&this.$contactForm.remove();const i=this.model.toJSON();i.allFields=t,i.channel=this.patronSession.getChannel(),this.$contactForm=e(this.templates.contact(i)),this.$log.append(this.$contactForm),this.$contactForm.find("form").on("submit",this.contactSave.bind(this)),this.$contactForm.find("input[name=client_contact]").focus(),this.scrollLog()},s.showRatingForm=function(){const t=this.model.toJSON();t.channel=this.patronSession.getChannel(),this.$ratingForm=e(this.templates.rating(t)),this.$log.append(this.$ratingForm),this.$ratingForm.find("form").on("submit",this.saveRating.bind(this)),this.$ratingForm.find('input[name="client_contact"]').val(this.patronSession.get("client_contact")),this.$ratingForm.find('input[type="checkbox"]').on("change",this.toggleCommentContactInput.bind(this)),this.scrollLog(),this.hideForm(),this.disableForm()},s.toggleCommentContactInput=function(){if(""!==this.patronSession.get("client_contact"))return;const t=e("#rate_client_contact"),i=t.parent("div.form-group"),s=this.$ratingForm.find("textarea[name=client_comment]");0===this.$ratingForm.find('input[type="checkbox"]:checked').length?(i.addClass("hidden"),t.attr("required",!1),s.attr("required",!1)):(i.removeClass("hidden"),t.attr("required",!0))},s.saveRating=function(t){t.preventDefault();const i=this.$ratingForm.find("form");i.find(".s-lch-form-error").remove();const s=this.$ratingForm.find("input[name=chat_rating]:radio:checked").val(),n=this.$ratingForm.find("textarea[name=client_comment]"),o=this.$ratingForm.find("input[name=request_followup]").prop("checked"),r=this.$ratingForm.find("input[name=email_transcript]").prop("checked");if(o||r){const t=this.$ratingForm.find("input[name=client_contact]"),e=t.val().trim();if(""===e||!this.model.validateContact(e))return void this.showValidationError(t,this.model.get("valid_form_c"));this.patronSession.setContactInfo(e)}o&&""===n.val()?this.showValidationError(n,this.model.get("translation").ch_include_comment):(i.find("button[type=submit], fieldset, textarea, input").prop("disabled",!0),e.ajax({url:i.attr("action"),type:"POST",dataType:"json",data:{rating:s,comment:n.val(),followup:o?1:0,transcript:r?1:0,client_contact:this.patronSession.get("client_contact"),queue_id:this.model.get("queue_id"),iid:this.model.get("iid"),page_name:this.model.get("referer_title"),page_url:this.model.get("referer")},success:this.ratingSaveSuccess.bind(this)}).fail(this.ratingSaveError.bind(this)))},s.ratingSaveSuccess=function(t){this.$ratingForm.find("input[name=request_followup]").prop("checked")&&(t.ticket.isSuccess&&this.model.set("ticketCreated",!0),this.showChatSysMsg({msg:t.ticket.message}));this.$ratingForm.find("input[name=email_transcript]").prop("checked")&&this.showChatSysMsg({msg:t.email.message}),this.showChatSysMsg({msg:this.model.get("translation").ch_comment_success})},s.ratingSaveError=function(){this.showChatSysMsg({msg:this.model.get("translation").ch_comment_error})},s.showValidationError=function(t,e){""!==e&&t.prev("label").removeClass("sr-only").append(`<span class="text-danger s-lch-form-error">${e}</span>`)},s.showFollowUpMsg=function(){this.model.get("ticketCreated")||this.model.get("followup_enabled")&&(this.enableForm(),this.showChatSysMsg({msg:this.model.get("followup_msg"),id:"s-lch-msg-followup"}))},s.removeFollowUpMsg=function(){this.$log.find("#s-lch-msg-followup").remove()},s.toggleSoundButton=function(){const t=!this.model.get("enable_sound");this.model.set("enable_sound",t);const i=e(".s-lch-btn-sound");let s="";t?(s=this.model.get("translation").ch_sound_on,i.attr("aria-label",s).find("i").removeClass("fa-volume-off").addClass("fa-volume-up")):(s=this.model.get("translation").ch_sound_off,i.attr("aria-label",s).find("i").removeClass("fa-volume-up").addClass("fa-volume-off")),i.find("span.icon-label").html(s),i.data("bs.tooltip").options.title=s},s.setOperatorTypingStatus=function(t){if("user"===t.role)return;const e=this.getOpName(t.opId);if(""===e)return;const i=this.currentTypers.indexOf(e);t.isTyping?-1===i&&this.currentTypers.push(e):-1!==i&&this.currentTypers.splice(i,1),0!==this.currentTypers.length?this.$chatTyping.html(`${this.currentTypers.join(", ")} ${this.model.get("translation").ch_op_typing}`):this.clearOperatorTyping()},s.clearOperatorTyping=function(){this.$chatTyping.html("")},s.showPeelButton=function(){this.inIframe()&&this.$el.find(".s-lch-btn-peel").removeClass("hidden")},s.hidePeelButton=function(){this.$el.find(".s-lch-btn-peel").addClass("hidden")},s.closeWidget=function(){this.model.emitter.trigger("closeWidget")},s.reloadCloseChat=function(){this.model.isFloat()||this.model.isTab()?this.model.emitter.trigger("closeWidget"):this.model.emitter.trigger("reloadWidget")},s.sendTranscript=function(){const t=e("<form></form>").attr({target:"_blank",action:`/chat/session/${this.patronSession.getChannel()}/transcript`,method:"post"}).addClass("hidden"),i=[];i.push(e("<input />").attr({type:"hidden",name:"iid"}).val(this.model.get("iid"))),i.push(e("<input />").attr({type:"hidden",name:"page_url"}).val(this.model.get("referer"))),i.push(e("<input />").attr({type:"hidden",name:"page_name"}).val(this.model.get("referer_title"))),i.push(e("<input />").attr({type:"hidden",name:"client_contact"}).val(this.patronSession.get("client_contact"))),t.append(i),e("body").append(t),t.trigger("submit"),t.remove()},s.getProfileImage=function(t){const e={path:this.model.get("defaultProfile"),color:""};if(0===this.operatorsList.length)return e;const i=this.operatorsList.find(e=>Number(e.get("opId"))===Number(t));return void 0!==i?i.get("profile_image"):e},s.getOpName=function(t){const e=this.operatorsList.find(e=>e.get("opId")===t);return void 0!==e?e.get("name"):""},s.insertMessageHistory=function(t,e){if("all"===e&&this.$log.attr("aria-live","off"),Array.isArray(t)&&t.length>0){const e=jQuery(".s-lch-msg-op");t.forEach((function(t){if("note"===t.role||"system"===t.system)return;0===e.filter((e,i)=>i.find(".s-lch-msg-txt").html()===t.msg).length&&(t.opId&&(t.profile_image=this.getProfileImage(t.opId)),this.showChatMsg(t))}),this)}"all"===e?(this.$log.attr("aria-live","polite"),this.showChatSysMsg({msg:this.model.get("translation").ch_reconnect_chat,id:""})):this.scrollLog()},s.showMissedChatMsg=function(){this.showChatSysMsg({msg:this.model.getMissedChatMessage(),id:""})},s.setMissedChatTimeout=function(){""!==this.patronSession.get("peel")||Number(this.model.get("missedchat_time"))<=0||(this.missedChatTime=window.setTimeout(this.showMissedChatMsg.bind(this),1e3*this.model.get("missedchat_time")))},s.triggerFallback=function(){this.emitter.trigger("triggerFallback")},s.setTimedFallbackTimeout=function(t){""!==this.patronSession.get("peel")||t<=0||(this.timedFallbackTime=window.setTimeout(this.triggerFallback.bind(this),1e3*t))},s.clearFallbackTimeout=function(){window.clearTimeout(this.timedFallbackTime)},s.accessibleIcons=function(){this.$el.find("button > .fa").each((t,i)=>{const s=e(i).parent("button"),n=s.attr("aria-label");""!==n&&s.tooltip({title:n,html:!0,placement:s.attr("data-tooltip")?s.attr("data-tooltip"):"bottom"})})},s.inIframe=function(){try{return window.self!==window.top}catch(t){return!0}},s.play_sound=function(){try{this.model.get("enable_sound")&&(this.audio||(this.audio=document.getElementById("sound")),this.audio.play())}catch(t){}},s.showOpJoin=function(t){window.clearTimeout(this.missedChatTime),this.clearFallbackTimeout(),this.play_sound(),this.showChatSysMsg({msg:`${t.get("name")} ${this.model.get("translation").ch_op_join}`,id:""}),this.removeFollowUpMsg()},s.showOpLeave=function(t){this.showChatSysMsg({msg:`${t.get("name")} ${this.model.get("translation").ch_op_left}`}),this.clearOperatorTyping(),this.play_sound()},s.showOpAway=function(t){this.clearOperatorTyping(),t.get("isAway")?this.showChatSysMsg({msg:`${t.get("name")} ${this.model.get("translation").ch_op_away}`}):this.showChatSysMsg({msg:`${t.get("name")} ${this.model.get("translation").ch_op_back}`})},s.showDeptGreeting=function(t=""){if(""===t)return;let e=this.model.get("translation").ch_dept_greeting;e&&(e=e.replace("%deptName%",t),this.showChatSysMsg({msg:e}))},s.showGreeting=function(t){this.showChatSysMsg({msg:this.model.getGreeting(t)})},s.showNewMessage=function(t){0!==t.opId&&(this.showChatMsg({msg:t.msg,ts:t.ts,name:this.getOpName(t.opId),opId:t.opId,role:t.role,profile_image:this.getProfileImage(t.opId)}),this.scrollLog(),this.play_sound(),this.enableForm())},s.showPatronMessage=function(t){this.clearTextarea(!0),this.showChatMsg({msg:t,name:"You",role:"user"}),this.scrollLog()},s.endChatDisplay=function(t){window.clearTimeout(this.missedChatTime),this.clearFallbackTimeout();const e=this.model.get("translation").ch_action_newchat,i=this.$el.find(".s-lch-btn-end");i.find("i").addClass("fa-repeat").removeClass("fa-times"),i.attr("aria-label",e),i.data("bs.tooltip").options.title=e,t&&this.model.get("answered")?(this.disableForm(),!0!==this.model.get("star_ratings")?this.showChatSysMsg({msg:this.model.get("byeMsg")}):this.showRatingForm()):this.showFollowUpMsg()},s.chatSubscribeDisplay=function(t){if(this.disableForm(),jQuery("#nologin_message").remove(),this.setConnectState(),""!==this.patronSession.get("client_question")&&this.showChatMsg({msg:this.patronSession.get("client_question"),name:"You",role:"user"}),t===this.model.get("status_away"))return this.showChatSysMsg({msg:this.model.getAwayMessage(),id:"msg_away"}),this.showFollowUpMsg(),void this.enableForm();this.showChatSysMsg({msg:this.model.get("wait"),id:""}),this.model.get("contact_request")&&""===this.model.get("client_contact")&&this.showContactRequestForm(),this.setMissedChatTimeout(),this.emitter.trigger("setFirstFallback")},s.enableChatting=function(){this.model.get("chatting")&&(this.enableForm(),this.$msgInput.focus(),this.$el.find(".s-lch-btn-trans, .s-lch-btn-file").removeClass("hidden"),this.showPeelButton())},s.peeledOutDisplay=function(){this.model.get("peelingParent")&&this.disableForm()},s.setConnectState=function(){const t=this.model.get("connected");let i,s;this.model.hasSubscribed?t?(i="connected",s=this.model.get("translation").ch_status_connected):(i="disconnected",s=this.model.get("translation").ch_status_disconnected,this.$el.find(".s-lch-btn-peel, .s-lch-btn-file").addClass("hidden")):(i="connected",s=this.model.get("translation").ch_status_connecting),e("#s-lch-status").removeClass("connected disconnected").addClass(i).html(`<span class="sr-only">${this.model.get("translation").ch_status_label}: </span>${s}`)},s.showReconnecting=function(){this.showChatSysMsg({msg:this.model.get("translation").ch_connect_lost,id:"msg_reconnecting"})},s.showReconnected=function(){this.showChatSysMsg({msg:this.model.get("translation").ch_connect_regained,id:"msg_reconnecting"}),this.enableForm(),this.$el.find(".s-lch-btn-file").removeClass("hidden"),this.showPeelButton()},s.showChatError=function(t=""){this.showChatSysMsg({msg:t||this.model.getErrorMessage(),id:"msg_error"})},s.showBlockedError=function(t=""){const e=t||this.model.getErrorMessage();this.$el.html(`<p class="alert alert-danger">${e}</p>`)},s.showChatAwayStatus=function(){this.showChatSysMsg({msg:this.model.getAwayMessage(),id:"msg_away"}),this.showFollowUpMsg()},s.disableForm=function(){this.$msgInput.prop("disabled",!0),this.$submitBtn.prop("disabled",!0)},s.hideForm=function(){this.$form.addClass("hidden")},s.enableForm=function(){this.$msgInput.prop("disabled",!1),this.$submitBtn.prop("disabled",!1)},s.showView=function(){if(this.$el.removeClass("hidden"),this.model.get("auth_id")>0&&!this.model.get("isAuthValidated"))return this.$el[0].querySelectorAll("input,select,button,textarea").forEach(t=>{t.disabled=!0}),this.$el[0].querySelectorAll('[tabindex="0"],a').forEach(t=>{t.setAttribute("tabindex","-1")}),void this.$el[0].setAttribute("aria-hidden","true");this.model.isEmbed()&&!this.model.get("answered")||this.$msgInput.focus()},s.toggleCloseButton=function(){this.model.isFloat()&&!this.model.peel||this.$el.find(".s-lch-btn-close").addClass("hidden")},s.showFileUploadPreview=function(t){const i=e(t.currentTarget).attr("href").split("?");if(i.length>1){t.preventDefault();const e=`/chat/session/${this.patronSession.getChannel()}/upload/preview?${i[1]}`;window.open(e,"_blank")}},s.showMessageNotSendable=function(){this.showChatSysMsg({msg:this.model.get("translation").ch_message_unsendable})},s.openNewTab=function(t){if(t.defaultPrevented)return;const e=t.currentTarget,i=e.getAttribute("href");if(0===i.indexOf("#"))return;"_blank"!==e.getAttribute("target")&&(t.preventDefault(),i&&"#"!==i?window.open(i,"_blank"):t.preventDefault())},s.render=function(){return this.$el.empty(),this.$el.html(this.templates.main(this.model.toJSON())),this.$form=this.$el.find("#s-lch-post-form"),this.$msgInput=this.$form.find("textarea"),this.$submitBtn=this.$form.find("button[type=submit]"),this.$log=this.$el.find("#s-lch-msg-log"),this.$chatTyping=this.$el.find("#istyping"),this.$contactForm=null,this.toggleCloseButton(),this.accessibleIcons(),this},"undefined"!=typeof module?module.exports=s:(t.springSpace=t.springSpace||{},t.springSpace.chat=t.springSpace.chat||{},t.springSpace.chat.chatWidgetChatView=s)}(this),function(t){const e=t.$,i=t._,s=Object.create(t.springyView);s.events={"click .btn-file-cancel":"closeView"},s.initialize=function(t){t.patronSession&&(this.patronSession=t.patronSession),t.emitter&&(this.emitter=t.emitter),t.$el=e("#file"),this.init(t),this.templates.main=i.template(e("#template-file-upload-panel").html())},s.closeView=function(){this.filedrop.reset(),this.$submitButton.val(this.model.get("file_action")).prop("disabled",!1),this.emitter.trigger("changeView","chat")},s.formValidate=function(t){return 0===t.countFiles()?(t.showError("No files found to upload."),!1):(0===this.$form.find("input[name=channel]").length?this.$form.prepend(e('<input type="hidden" name="channel" />').val(this.patronSession.getChannel())):this.$form.find("input[name=channel]").val(this.patronSession.getChannel()),!0)},s.formError=function(t,e){let i="";if(413===Number(t.status))i="Total file size is too large. Trying uploading smaller or fewer files.";else if(400===Number(t.status)){if(t.responseText)try{const e=JSON.parse(t.responseText);e.error&&(i=e.error)}catch(t){}}else i=this.model.get("translation").ch_file_error;e.showError(i)},s.formSuccess=function(t,e){const i=document.createElement("span");i.innerText="attached a file: ";const s=document.createElement("a");s.href=t.url,s.setAttribute("target","_blank"),s.classList.add("s-la-cfile"),s.innerText=t.url,"inline"!==t.preview&&"modal"!==t.preview||(s.dataset.preview=t.preview),i.appendChild(s),this.emitter.trigger("fileUpload",i.outerHTML),e.reset()},s.showView=function(){this.$el.removeClass("hidden");const t=this.el.querySelector("input, textarea, select, a, button, [tabindex]");t&&t.focus()},s.render=function(){this.$el.empty();const e=this.model.toJSON();return e.channel=this.patronSession.getChannel(),this.$el.html(this.templates.main(e)),this.$form=this.$el.find("form"),this.$submitButton=this.$form.find("button[type=submit]"),this.filedrop=new t.springSpace.sui.filedrop({selector:"#s-lch-file-form",autoupload:!1,max_files:1,max_upload_size:20971520,max_file_size:20971520,callback:this.formSuccess.bind(this),error_callback:this.formError.bind(this),validate:this.formValidate.bind(this)}),this},"undefined"!=typeof module?module.exports=s:(this.springSpace=this.springSpace||{},this.springSpace.chat=this.springSpace.chat||{},this.springSpace.chat.chatWidgetFileView=s)}(this),function(t){const e=t.$,i=t._,s=Object.create(t.springyView);s.events={"click .s-lch-btn-close":"closeWidget"},s.initialize=function(t){t.$el=e("#offline"),t.patronSession&&(this.patronSession=t.patronSession),t.emitter&&(this.emitter=t.emitter),this.init(t),this.templates.main=i.template(e("#template-chat-offline").html()),this.renderOfflineMessages()},s.renderOfflineMessages=function(){let t="",e="";try{t=i.template(this.model.get("la_hide_msg"))({domain:this.model.get("domain")})}catch(e){t=this.model.get("la_hide_msg")}try{e=i.template(this.model.get("la_hide_msg2"))({domain:this.model.get("domain")})}catch(t){e=this.model.get("la_hide_msg2")}this.model.set({la_hide_msg:t,la_hide_msg2:e},{silent:!0})},s.showView=function(){if(this.$el.removeClass("hidden"),this.model.isEmbed())return;const t=this.el.querySelector("input, textarea, select, a, button, [tabindex]");t&&t.focus()},s.closeWidget=function(){this.model.emitter.trigger("closeWidget")},s.render=function(){this.$el.empty(),this.$el.html(this.templates.main(this.model.toJSON()));const t=this.model.offlineLinkTarget();return this.$el.find("a, form").each((i,s)=>{void 0===e(s).attr("target")&&e(s).attr("target",t)}),(this.model.isFloat()||this.model.isTab())&&this.$el.find(".s-lch-btn-close").removeClass("hidden"),this},"undefined"!=typeof module?module.exports=s:(t.springSpace=t.springSpace||{},t.springSpace.chat=t.springSpace.chat||{},t.springSpace.chat.chatWidgetOfflineView=s)}(this),function(t){const e=t._,i=t.springSpace.chat.ChatMessage,s=t.adjustStatusRequestForCoverage,n=t.springSpace.sui.eventEmitter,o={model:null,socketIoUrl:null,cascadeServer:"",altCascadeServer:"",cascade:null,eventEmitter:null,patronSession:null,attemptedFallbackCoops:[],operatorsList:[],views:{},departments:{},typing_end_timeout:null,is_typing_currently:!1,disconnects:[],disconnectTimeThreshold:15,disconnectCountThreshold:2,transports:["websocket"],saveSessionId:function(){const e=this.patronSession.get("sessionId");if(""===e)return;const i={sessionId:e,date:Math.floor(Date.now()/1e3),iid:Number(this.patronSession.get("iid")),widgetId:this.model.get("id"),url:this.patronSession.get("referer")};t.springSpace.sui.storage.set("libchat_session",JSON.stringify(i))},getSessionId:function(){let e=t.springSpace.sui.storage.get("libchat_session");if(""===e)return"";try{if(e=JSON.parse(e),!e.sessionId||""===e.sessionId)return this.deleteSessionId(),"";return Math.floor(Date.now()/1e3)-e.date>120||e.iid!==Number(this.model.get("iid"))?(this.deleteSessionId(),""):e.widgetId!==this.model.get("id")||!this.patronSession.get("isPeel")&&e.url.replace("&amp;","&")!==this.patronSession.get("referer")?"":e.sessionId}catch(t){this.deleteSessionId()}return""},deleteSessionId:function(){t.springSpace.sui.storage.remove("libchat_session")},postWindowMessage:function(t,e){const i={libchat_widget:this.model.get("id"),action:t};if(void 0!==e){Object.keys(e).forEach(t=>{i[t]=e[t]})}window.parent.postMessage(i,"*")},adjustWidgetHeight:function(){window.innerHeight>0&&$("body").css("height",window.innerHeight)},findFirstFocusable:function(t){return void 0===t&&(t=document),t.querySelector("input, textarea, select, a, button, [tabindex]")},closeChat:function(){this.postWindowMessage("closeWidget")},changeViewTo:function(t){this.views[t]&&($(".chatpane").addClass("hidden"),this.views[t].showView(),this.adjustWidgetHeight())},reloadWidget:function(){this.deleteSessionId(),window.location.reload()},renderLibAuthOverlay:function(){if(this.model.get("auth_id")<=0||this.model.get("isAuthValidated"))return;this.views.libauth=Object.create(t.springSpace.chat.chatWidgetAuthView);const e={model:this.model,patronSession:this.patronSession};this.views.libauth.initialize(e),this.views.libauth.render()},denyAutopopRequest:function(){this.postWindowMessage("closeWidget"),this.saveAutoPopDeny()},acceptAutopopRequest:function(){this.postWindowMessage("chatStarted"),!1===this.model.get("skip_login")?this.renderLogin():this.renderChatView()},renderAutoload:function(){if(!this.views.auto){this.views.auto=Object.create(t.springSpace.chat.chatWidgetAutoView);const e={model:this.model,events:{"click #s-lch-autoload-yes":this.acceptAutopopRequest.bind(this),"click #s-lch-autoload-no":this.denyAutopopRequest.bind(this)}};this.views.auto.initialize(e),this.views.auto.render()}this.views.auto.isShowing()||(this.changeViewTo("auto"),this.postWindowMessage("autopop"),setTimeout(()=>{let t=$("#autoload")[0].scrollHeight;t+=3*parseInt($("body").css("padding-top"),10),this.postWindowMessage("height",{height:t})},100))},resetOnlineStatus:function(){this.model.set("online_rule",!1),this.patronSession.set({uid:0,did:0,coopId:""})},handleStatusCheck:function(t){if(!t.u&&!t.d&&!t.c||!t.u&&0===t.d.length&&""===t.c)return this.resetOnlineStatus(),this.renderOffline(),void this.postWindowMessage("changeStatus",{online:!1});const e={u:t.u||0,d:[],c:t.c||""};t.d&&Array.isArray(t.d)&&t.d.forEach((function(t){this.departments[t]&&e.d.push(this.departments[t])}),this),this.model.set("online_rule",e);const i=this.model.getOnlineDept(),s={uid:e.u,did:i.id?i.id:0,coopId:""};0===s.uid&&0===s.did&&(s.coopId=e.c||""),this.patronSession.set(s),this.postWindowMessage("changeStatus",{online:!0}),this.startWidget()},getOnlineStatus:function(){const t=s(this.model.get("onlinerules"));$.ajax({url:this.cascadeServer+"/widget_status",dataType:"json",data:{iid:this.model.get("iid"),rules:JSON.stringify(t)},success:this.handleStatusCheck.bind(this),timeout:1e4}).fail(()=>{this.resetOnlineStatus(),this.renderOffline()})},renderOffline:function(){if(!this.views.offline){this.views.offline=Object.create(t.springSpace.chat.chatWidgetOfflineView);const e={model:this.model,patronSession:this.patronSession,emitter:this.eventEmitter};this.views.offline.initialize(e),this.views.offline.render()}this.changeViewTo("offline"),this.postWindowMessage("expandWidget"),this.deleteSessionId()},handleMessageSubmit:function(t){if(""!==t)return null===this.cascade?(this.patronSession.set("client_question",t),this.model.set("client_question",t),this.views.chat.clearTextarea(),this.model.get("contact_request")&&this.model.get("contact_required")?void this.eventEmitter.trigger("requestContact"):void this.startSession()):document.getElementById("s-lch-msg-followup")?""===this.patronSession.get("client_contact")?void this.eventEmitter.trigger("requestContact"):void this.createTicket(t):void(!this.cascade.disconnected&&this.model.get("chatting")?this.postChatMsg(t):this.eventEmitter.trigger("chatMsgNotSendable"))},handleFileUpload:function(t){const e={room:this.patronSession.getRoom(),message:t};this.cascade.emit("newMessage",e),this.eventEmitter.trigger("changeView","chat"),this.views.chat.showFileUpload(t)},renderLogin:function(){if(!this.views.login){this.views.login=Object.create(t.springSpace.chat.chatWidgetLoginView);const e={model:this.model,patronSession:this.patronSession};this.views.login.initialize(e)}this.views.login.render(),this.changeViewTo("login"),this.renderLibAuthOverlay()},renderChatView:function(){if(!this.views.chat){this.views.chat=Object.create(t.springSpace.chat.chatWidgetChatView);const e={model:this.model,events:{"click .s-lch-btn-file":this.renderFileView.bind(this),"click .s-lch-btn-peel":this.peelOut.bind(this),"click .s-lch-btn-end":this.endChat.bind(this),"click .s-lch-btn-close":this.closeChat.bind(this)},patronSession:this.patronSession,emitter:this.eventEmitter,operatorsList:this.operatorsList};this.views.chat.initialize(e),this.views.chat.render()}this.changeViewTo("chat"),this.renderLibAuthOverlay()},renderFileView:function(){if(!this.views.file){this.views.file=Object.create(t.springSpace.chat.chatWidgetFileView);const e={model:this.model,patronSession:this.patronSession,emitter:this.eventEmitter};this.views.file.initialize(e),this.views.file.render()}this.changeViewTo("file")},startWidget:function(){const t=this.getSessionId();if(""===t){if(this.model.get("autopop")&&!this.model.isEmbed()&&!this.model.isButton()){if(!1===this.autoPopDenied())return void this.renderAutoload();this.model.set("autologin",!1)}if(this.postWindowMessage("expandWidget"),!1===this.model.get("skip_login"))this.renderLogin();else if(this.renderChatView(),this.model.get("online_rule").away)return void this.eventEmitter.trigger("chatAway");if(!0===this.model.get("autologin")){if(this.model.get("contact_request")&&this.model.get("contact_required"))return void this.eventEmitter.trigger("requestContact");this.startSession()}}else this.startPeel(t)},startPeel:function(t){this.patronSession.set("sessionId",t),this.patronSession.set("peel",t),this.model.set("peel",t),this.loadSocketIo(),this.postWindowMessage("expandWidget")},startSessionSuccess:function(t){this.patronSession.set(t.session);const e=this.patronSession.get("fallbacks");if(e){const t=s(e);this.patronSession.set("fallbacks",t)}this.loadSocketIo()},startSessionError:function(t){let e="";if(t&&t.responseText)try{const i=JSON.parse(t.responseText);i.error&&(e=i.error)}catch(t){e=""}let i="chatError";t&&403===t.status&&(i="chatBlockedError"),this.model.emitter.trigger(i,e)},validateSession:function(){""===this.patronSession.get("name")&&this.patronSession.set("name",this.model.generateAnonName())},startSession:function(){this.validateSession();const t=this.patronSession.toJSON();t.key=this.model.get("key"),t.widget_id=this.model.get("id"),t.unit_id=this.model.get("unit_id"),t.auth_id=this.model.get("auth_id"),$.ajax({url:"/chat/session",type:"POST",dataType:"json",data:t,cache:!1,success:this.startSessionSuccess.bind(this),error:this.startSessionError.bind(this)})},removeOperator:function(t,e,i){if(!t.opId||"op"!==t.role||0===this.operatorsList.length)return;const s=this.operatorsList.findIndex(e=>Number(e.get("opId"))===t.opId);if(s<0)return;const n=this.operatorsList[s];this.eventEmitter.trigger("opLeave",n),this.operatorsList.splice(s,1),this.operatorsList.length>0&&!i||(this.model.set({chatting:!1,reconnect:!1}),this.cascade.emit("signout",{}),e||this.consolidateMsg(this.patronSession.getChannel()),this.cascade.disconnect(),this.cleanUpDisconnect(e))},setOperatorPending:function(t){if(!t.opId||"op"!==t.role||0===this.operatorsList.length)return;const e=this.operatorsList.find(e=>e.get("opId")===t.opId);void 0!==e&&!0!==e.get("isAway")&&(e.set("isAway",!0),e.setPendingTimeout(this.removeOperator.bind(this,e,!1,!1)),this.eventEmitter.trigger("opAway",e))},setOperatorReconnected:function(e){if(!e.opId||"op"!==e.role||0===this.operatorsList.length)return;let i=this.operatorsList.find(t=>t.get("opId")===e.opId);if(void 0===i)i=Object.create(t.springSpace.chat.opSession),i.set(e),this.operatorsList.push(i);else{if(i.clearPendingTimeout(),!1===i.get("isAway"))return;i.set("isAway",!1)}this.eventEmitter.trigger("opAway",i)},consolidateMsg:function(t){$.ajax({url:`/chat/session/${t}/consolidate`,type:"POST",dataType:"json",data:{iid:this.model.get("iid")},success:function(){},error:function(){}})},cleanUpDisconnect:function(t){try{this.deleteSessionId(),this.model.set({chatting:!1,peelingParent:!1}),this.eventEmitter.trigger("endChat",t),t&&(this.disconnects=[])}catch(t){}},peelOut:function(){this.saveSessionId(),this.model.set({peelingParent:!0,reconnect:!1});let t=400;const e=this.model.get("height").toString();-1===e.indexOf("%")&&(t=parseInt(e,10));let i=375;const s=this.model.get("width").toString();-1===s.indexOf("%")&&(i=parseInt(s,10));const n=window.open(this.model.getPeelUrl(),"name",`height=${t},width=${i},fullscreen=0,location=0,menubar=0,status=0`);window.focus&&n.focus()},postChatMsg:function(t){t=this.model.sanitizeMessage(t),this.cascade.emit("newMessage",{room:this.patronSession.getRoom(),message:t}),this.eventEmitter.trigger("patronMessagePosted",t),this.setPatronTypingStatus(!1),this.saveSessionId()},timeoutTypingStatus:function(){this.setPatronTypingStatus(!1)},setPatronTypingStatus:function(t){if(window.clearTimeout(this.typing_end_timeout),this.is_typing_currently!==t){if(this.is_typing_currently=t,t&&(this.typing_end_timeout=setTimeout(this.timeoutTypingStatus.bind(this),5e3)),this.model.get("connected")){const e={id:this.patronSession.get("sessionId"),room:this.patronSession.getRoom(),isTyping:t};this.cascade.emit("typingStatus",e)}}else this.is_typing_currently&&(this.typing_end_timeout=setTimeout(this.timeoutTypingStatus.bind(this),5e3))},endChat:function(){try{this.deleteSessionId(),this.model.set("reconnect",!1),this.cascade&&this.cascade.connected?(this.cascade.emit("patronChatEnd",{}),this.cascade.disconnect(),this.cleanUpDisconnect(!0)):this.reloadWidget()}catch(t){this.eventEmitter.trigger("chatError","",!0)}},messageHistorySuccess:function(t){this.views.chat.insertMessageHistory(t.content,t.which)},getMessageHistory:function(t){void 0!==t&&-1!==["op","all"].indexOf(t)||(t="op"),$.ajax({url:`/chat/session/${this.patronSession.getChannel()}/messages`,type:"GET",cache:!1,dataType:"json",data:{iid:this.model.get("iid"),which:t},success:this.messageHistorySuccess.bind(this),error:()=>{}})},saveAutoPopDeny:function(){const e={date:Math.floor(Date.now()/1e3)};t.springSpace.sui.storage.set("libchat_auto",JSON.stringify(e))},autoPopDenied:function(){let e=t.springSpace.sui.storage.get("libchat_auto");if(""===e)return!1;try{e=JSON.parse(e);return!(Math.floor(Date.now()/1e3)-e.date>3600)||(this.deleteAutoPopDeny(),!1)}catch(t){this.deleteAutoPopDeny()}return!1},deleteAutoPopDeny:function(){t.springSpace.sui.storage.remove("libchat_auto")},setupHeightResize:function(){try{(function(t,e,i){i=i||window;let s=!1;i.addEventListener(t,(function(){s||(s=!0,requestAnimationFrame(()=>{i.dispatchEvent(new CustomEvent(e)),s=!1}))}))})("resize","optimizedResize"),window.addEventListener("optimizedResize",this.adjustWidgetHeight.bind(this))}catch(t){}},contactSaveSuccess:function(){this.views.chat.contactFormSuccess(),this.cascade.connected&&this.cascade.emit("memberUpdate",{sessionId:this.patronSession.get("sessionId"),updates:{client_contact:this.patronSession.get("client_contact"),name:this.patronSession.get("name"),user1:this.patronSession.get("user1"),user2:this.patronSession.get("user2"),user3:this.patronSession.get("user3")}})},handleContactSave:function(t){$.ajax({url:t.attr("action"),type:"POST",dataType:"json",data:{channel:this.patronSession.getChannel(),client_contact:this.patronSession.get("client_contact"),name:this.patronSession.get("name"),user1:this.patronSession.get("user1"),user2:this.patronSession.get("user2"),user3:this.patronSession.get("user3")},success:this.contactSaveSuccess.bind(this)}).fail(this.views.chat.contactSaveError)},ticketSaveSuccess:function(t){this.views.chat.showPatronMessage(t.body),this.views.chat.enableForm(),this.views.chat.showChatSysMsg({msg:t.message}),this.model.set("ticketCreated",!0),this.cascade&&this.cascade.connected&&this.endChat()},ticketSaveError:function(t){this.views.chat.enableForm();let e="Sorry, an error occurred trying to create a Ticket.";if(400===t.status&&t.responseText)try{const i=JSON.parse(t.responseText);i.error&&(e=i.error)}catch(t){}this.views.chat.showChatSysMsg({msg:e})},createTicket:function(t){this.views.chat.disableForm(),$.ajax({url:`/chat/session/${this.patronSession.getChannel()}/ticket`,type:"POST",dataType:"json",data:{msg:t,iid:this.model.get("iid"),queue_id:this.model.get("queue_id")},success:this.ticketSaveSuccess.bind(this)}).fail(this.ticketSaveError.bind(this))},setStateReconnecting:function(){this.model.hasSubscribed&&this.eventEmitter.trigger("chatReconnecting")},setStateCascadeError:function(){this.model.set("connected",!1),this.model.hasSubscribed&&this.eventEmitter.trigger("chatError","")},handleCascadeConnect:function(){let t=!1;if(this.model.get("hasConnected")&&this.patronSession.get("sessionId")&&(t=!0),this.model.set({connected:!0,reconnect:!0,hasConnected:!0}),t)return this.model.get("answered")&&this.getMessageHistory(),void(this.model.hasSubscribed&&this.eventEmitter.trigger("chatReconnected"));this.cascade.emit("subscribe",this.patronSession.toJSON())},getCurrentUnixSeconds:function(){return Math.floor(Date.now()/1e3)},checkDisconnects:function(){const e=this.getCurrentUnixSeconds(),i=this.disconnectTimeThreshold;if(this.disconnects=this.disconnects.filter(t=>e-t<=i),!(this.disconnects.length<this.disconnectCountThreshold)){if(this.cascadeServer===this.altCascadeServer)return this.cascade.close(),t.springSpace.sui.notify.hide(),this.setStateCascadeError(),void this.cleanUpDisconnect(!1);this.cascadeServer=this.altCascadeServer,this.cascade.close(),this.cascade=null,this.model.get("answered")||this.model.set("hasConnected",!1),this.transports.unshift("polling"),this.setupSocket()}},handleCascadeDisconnect:function(){this.model.set("connected",!1),this.cascade.io.opts.query+="&reconnect=true",this.model.get("reconnect")&&(this.disconnects.push(this.getCurrentUnixSeconds()),this.checkDisconnects())},handleCascadeReconnectRejection:function(){this.eventEmitter.trigger("chatError"),this.model.set({chatting:!1,reconnect:!1}),this.cascade.emit("signout",{}),this.cascade.disconnect(),this.cleanUpDisconnect(!1)},handleCascadeSubscribeFail:function(){t.springSpace.sui.notify.hide(),this.model.set("reconnect",!1),this.cascade.disconnect(),this.reloadWidget()},handleCascadePeelSubscribe:function(e){t.springSpace.sui.notify.hide(),Array.isArray(e.ops)&&e.ops.forEach((function(e){const i=Object.create(t.springSpace.chat.opSession);i.set(e),this.operatorsList.push(i),this.model.set("answered",!0)}),this),this.patronSession.set(e.patronData),this.model.set("referer",this.patronSession.get("referer")),this.model.set("chatting",!0),this.getMessageHistory("all"),this.saveSessionId()},handleCascadeSubscribe:function(e){if(t.springSpace.sui.notify.hide(),e.online_status===this.model.get("status_offline"))return this.views.chat.showChatSysMsg({msg:this.model.getOfflineMessage(),id:""}),this.model.set({chatting:!1,reconnect:!1}),this.cascade.emit("signout",{}),this.cascade.disconnect(),this.cleanUpDisconnect(!1),void window.clearTimeout(this.views.chat.missedChatTime);this.model.hasSubscribed=!0,this.eventEmitter.trigger("chatSubscribe",e.online_status)},handleOperatorJoin:function(e){let i;e.transferHist&&this.patronSession.set("transferHist",e.transferHist),this.model.set({chatting:!0,answered:!0});let s=!1;if(this.operatorsList.length>0&&(i=this.operatorsList.find(t=>t.get("opId")===e.op.opId)),void 0===i&&(i=Object.create(t.springSpace.chat.opSession),i.set(e.op),this.operatorsList.push(i),s=!0),1===this.operatorsList.length){let t="";if(e.patronUpdate&&e.patronUpdate.did>0){const i=this.departments[e.patronUpdate.did];i&&(t=i.name,this.eventEmitter.trigger("deptGreeting",t))}}if(this.eventEmitter.trigger("opJoin",i,s),1===this.operatorsList.length){const t=i.iid===this.model.get("iid");this.eventEmitter.trigger("showGreeting",t)}this.saveSessionId()},handleChatEnd:function(t){this.removeOperator(t.op,!0,!0)},handleOperatorLeave:function(t){this.removeOperator(t.op,!0,!1)},handleOperatorDisconnect:function(t){this.setOperatorPending(t)},handleOperatorPending:function(t){this.setOperatorPending(t)},handleOperatorReconnect:function(t){this.setOperatorReconnected(t)},handleNewMessage:function(t){const e=new i(t);this.views.chat.showNewMessage(e),this.postWindowMessage("newMessage")},handleScreenshareChange:function(t){const e=t.isEnd?"ended":"started",i=`This screensharing session has ${e}.`;this.views.chat.showChatSysMsg({msg:i,id:"screenshare_"+e})},triggerFallback:function(){const t=this.patronSession.get("fallbacks"),e=this.patronSession.get("coopId");let i="",s=0;for(;s<t.length;s++){const n=t[s];if(!n.c)continue;if(this.attemptedFallbackCoops.indexOf(n.c)>-1)continue;if(e===n.c){this.attemptedFallbackCoops.push(n.c);continue}const o=Number(n.fallbackSeconds||this.model.get("timedFallback"));if(o&&!(o<=0)){i=n.c;break}}if(!i)return;if(this.attemptedFallbackCoops.push(i),this.cascade.emit("triggerFallback",{coopId:i}),s++,s>=t.length)return;let n=0;for(;s<t.length;s++){const e=t[s];if(n=Number(e.fallbackSeconds||this.model.get("timedFallback")),n>0)break}this.views.chat.setTimedFallbackTimeout(n)},setFirstFallBackTime:function(){const t=this.patronSession.get("fallbacks"),e=this.patronSession.get("coopId"),i=t.filter(t=>{const i=Number(t.fallbackSeconds||this.model.get("timedFallback"));return t.c&&i>0&&-1===this.attemptedFallbackCoops.indexOf(t.c)&&t.c!==e});if(0===i.length)return;const s=i[0],n=Number(s.fallbackSeconds||this.model.get("timedFallback"));this.views.chat.setTimedFallbackTimeout(n)},handleFallbackOffline:function(){this.views.chat.clearFallbackTimeout(),this.patronSession.get("isAnswered")||this.triggerFallback()},loadSocketIo:function(){t.springSpace.sui.notify.working();const e=document.createElement("script");document.body.appendChild(e),e.onerror=()=>{this.model.emitter.trigger("chatError")},e.onload=this.setupSocket.bind(this),e.src=this.socketIoUrl},handleError:function(){this.setStateCascadeError()},handleConnectError:function(t){console.log("cascade connect_error"),console.log(t),this.setStateCascadeError(),this.disconnects.push(this.getCurrentUnixSeconds()),this.checkDisconnects()},handleReconnectFailed:function(){console.log("cascade reconnect_failed"),this.setStateCascadeError(),this.cleanUpDisconnect(!1)},registerCascadeListeners:function(){this.cascade.on("reconnecting",this.setStateReconnecting.bind(this)),this.cascade.on("error",this.handleError.bind(this)),this.cascade.on("connect_error",this.handleConnectError.bind(this)),this.cascade.on("reconnect_failed",this.handleReconnectFailed.bind(this)),this.cascade.on("connect",this.handleCascadeConnect.bind(this)),this.cascade.on("disconnect",this.handleCascadeDisconnect.bind(this)),this.cascade.on("reconnectReject",this.handleCascadeReconnectRejection.bind(this)),this.cascade.on("subscribe_failed",this.handleCascadeSubscribeFail.bind(this)),this.cascade.on("peel_subscribed",this.handleCascadePeelSubscribe.bind(this)),this.cascade.on("subscribed",this.handleCascadeSubscribe.bind(this)),this.cascade.on("chatJoin",this.handleOperatorJoin.bind(this)),this.cascade.on("typingStatus",this.views.chat.setOperatorTypingStatus.bind(this.views.chat)),this.cascade.on("newMessage",this.handleNewMessage.bind(this)),this.cascade.on("chatLeft",this.handleOperatorLeave.bind(this)),this.cascade.on("chatEnd",this.handleChatEnd.bind(this)),this.cascade.on("member_removed",this.handleOperatorDisconnect.bind(this)),this.cascade.on("member_pending",this.handleOperatorPending.bind(this)),this.cascade.on("member_reconnected",this.handleOperatorReconnect.bind(this)),this.cascade.on("requestContact",this.eventEmitter.trigger.bind(this.eventEmitter,"requestContact",!0)),this.cascade.on("screenshareChange",this.handleScreenshareChange.bind(this)),this.cascade.on("fallbackOffline",this.handleFallbackOffline.bind(this))},setupSocket:function(){this.renderChatView(),this.model.set("peelingParent",!1),this.deleteAutoPopDeny();const e={iid:this.patronSession.get("iid"),sessionId:this.patronSession.get("sessionId"),src:"user",peel:this.patronSession.get("peel")};this.model.get("hasConnected")&&this.model.get("answered")&&(e.reconnect=!0);const i=Object.keys(e).map(t=>`${t}=${encodeURIComponent(e[t])}`).join("&");this.cascade=t.io(this.cascadeServer,{"force new connection":!1,reconnectionAttempts:10,reconnectionDelay:3e3,timeout:15e3,query:i,transports:this.transports}),this.model.cascade=this.cascade,this.registerCascadeListeners()},registerEvents:function(){document.body.addEventListener("keydown",t=>{"Escape"===t.key&&this.closeChat()}),this.model.emitter.on("change:loggedIn",this.startSession,this),this.model.emitter.on("isTyping",this.setPatronTypingStatus,this),this.model.emitter.on("messageSubmit",this.handleMessageSubmit,this),this.model.emitter.on("changeView",this.changeViewTo,this),this.model.emitter.on("fileUpload",this.handleFileUpload,this),this.model.emitter.on("contactSave",this.handleContactSave,this),this.model.emitter.on("startSession",this.startSession,this),this.model.emitter.on("closeWidget",this.closeChat,this),this.model.emitter.on("reloadWidget",this.reloadWidget,this),this.model.emitter.on("triggerFallback",this.triggerFallback,this),this.model.emitter.on("setFirstFallback",this.setFirstFallBackTime,this),document.addEventListener("visibilitychange",()=>{if("visible"===document.visibilityState){if(this.model.get("chatting")||this.model.get("hasConnected")||this.model.get("answered")||this.model.get("loggedIn")||this.model.get("peel")||this.model.get("peelingParent"))return;this.getOnlineStatus()}})},init:function(t,i,s,o,r,a){this.model=t,this.patronSession=i,this.cascadeServer=s,this.altCascadeServer=a,this.socketIoUrl=o,this.departments=r,this.eventEmitter=new n,this.model.emitter=this.eventEmitter,void 0===window.FormData&&this.model.set("file_uploads",!1,{silent:!0}),this.adjustWidgetHeight(),this.setupHeightResize();try{const t=e.template($("#template-css").text());$("#styletemplate").text(t(this.model.toJSON()))}catch(t){}const l=this.model.get("custom_css");""!==l&&$("head").append(`<style>${l}</style>`),this.getOnlineStatus(),this.registerEvents()}};"undefined"!=typeof module?module.exports=o:(t.springSpace=t.springSpace||{},t.springSpace.chat=t.springSpace.chat||{},t.springSpace.chat.chatWidgetControl=o)}(window),function(t){var e=t.springSpace.sui.initAutocomplete,i={id:0,iid:0,apiDomain:"",groupId:0,form:null,limit:10,autocomplete:null,autcompleteDataFormatCb:function(t){var e=[];return t.results.forEach((function(t){t.label=t.question,e.push(t)})),e},autocompleteSelectCb:function(t){var e=this.form.querySelector("input[name=faqid]");null===e&&((e=document.createElement("input")).setAttribute("type","hidden"),e.setAttribute("name","faqid"),this.form.insertBefore(e,this.form.firstChild)),e.value=t.getAttribute("data-faqid"),this.form.submit()},enableAutocomplete:function(){try{this.autocomplete=e({inputSelector:"#s-la-content-search-query-"+this.id,queryUrl:"https://"+this.apiDomain+"/1.0/faqsearch/",dataProcessor:this.autcompleteDataFormatCb.bind(this),selectCallback:this.autocompleteSelectCb.bind(this),queryData:{rows:this.limit,iid:this.iid,group_ids:this.groupId}})}catch(t){console.log(t.message)}},init:function(t){this.id=t.contentId,this.iid=t.iid,this.apiDomain=t.apiDomain,this.groupId=JSON.stringify(t.groupId),this.form=document.querySelector("#s-la-content-search-"+this.id+" form"),this.limit=t.limit?t.limit:10,this.enableAutocomplete()}},s=function(t){var e=Object.create(i);return e.init(t),e};"undefined"!=typeof module?module.exports=s:(t.springSpace=this.springSpace||{},t.springSpace.la=this.springSpace.la||{},t.springSpace.la.initFaqSearchForm=s)}(this);
//# sourceMappingURL=maps/libchatwidget.min.js.map
